import{u as k,a as O,l as I,j as s,H as A,b as T,t as n,d,e as b,f as x,g as C}from"./main-TA8bC7Bt.js";import{A as H}from"./app-layout-D7dr2l9G.js";import q from"./api-test-layout-BijyWkRN.js";import L from"./test-case-sidebar-q5BESWB0.js";import P from"./test-case-form-DmOyUnCL.js";import _ from"./test-case-output-D8-5AAU8.js";import{u as h}from"./useQuery-BzlHZdep.js";import{u as K}from"./useApiTestService-CeshE40R.js";import{F as Q}from"./index.esm-D8l67r9b.js";import{u as R}from"./documentation-tab-CNpg38vI.js";import{u as f}from"./useAppSelector-B1phOAD2.js";import{s as z}from"./apiTestSelectors-BJyltacD.js";import{F as B}from"./form-ozKIHDmp.js";import{s as j}from"./clientDatabaseSelectors-BCEKIPh0.js";import{u as G}from"./use-show-toast-i-8s27K3.js";import{u as J}from"./useClientDatabaseService-DkZWdFKp.js";import"./button-Cbt3Ix14.js";import"./index-B4-W0Byi.js";import"./index-Du_cN1mI.js";import"./x-CJXZ5As_.js";import"./createLucideIcon-zbHoiiAn.js";import"./chevron-right-D63WMaCz.js";import"./dropdown-menu-D0gVy8Hw.js";import"./index-DgUBjAyu.js";import"./index-BBcvBNZT.js";import"./index-Dgh_HRrV.js";import"./check-DxqNlIfg.js";import"./useAuthState-DTIA1H-J.js";import"./index-DPFCTu8d.js";import"./tree-view-BfRshzyQ.js";import"./input-dLup5WN3.js";import"./ApiTestFormField-DVFIzABv.js";import"./ApiTestViewModel-BMXxkX3L.js";import"./skeleton-Bs0S7sAS.js";import"./tabs-Es8LGXR4.js";import"./data-tab-B2ck-8Z8.js";import"./select-D5VTl43s.js";import"./api-test-data-table-Dg02hs6N.js";import"./index-CtVAL_3k.js";import"./table-XDPYTTe_.js";import"./ColumnConfig-DosrtjSH.js";import"./ApiTestDataFormField-B5ImqALB.js";import"./table-selection-popover-Dny9kYnd.js";import"./popover-SzdN6lWv.js";import"./label-BvyJtc9X.js";import"./ClientDatabaseTableViewModel-CWID7VbN.js";import"./loader-circle-KgTJtckO.js";import"./scenario-tab-DprloNwK.js";import"./useRequest-BVaukJYn.js";import"./BaseEntity-DGhPHkWu.js";import"./serviceHandler-BlQljMi1.js";import"./ClientDatabaseViewModel-CZz8IN5P.js";import"./zod-rjVO2UHr.js";import"./schemas-D95ZC4Tg.js";import"./textarea-CaWnQ867.js";function Xe(){const r=k(),{indexApiTest:y,createApiTest:U,updateApiTest:g}=K(),a=f(z),i=f(j),D=f(j),{form:o}=R({apiTestDTO:a}),p=G(),v={offset:"0",limit:"10",sort:"table",order:"asc",filter:""},{data:u}=h({queryKey:["/backend/api_test/index"],queryFn:async()=>await y(),enabled:!0});h({queryKey:["/backend/client_database/get-table-list"],queryFn:async()=>{await F({params:v,clientDatabaseToken:D?.password??""},{callbacks:{onSuccess:t=>{const c={total:t.total,rows:t.rows.map(l=>l.dto)};r(C(c))},onError:t=>{p("Error","Failed to load client database tables","error"),console.error(t)}}})},enabled:!!D?.password});const{getTableList:F}=J();O.useEffect(()=>{u&&r(I(u))},[r,u]);const E=async()=>{try{if(a&&i&&i.password){const t=o.getValues("apiTestData");console.log("FormValues",t);const c=t.map(e=>({UUID:e.UUID,apiTest:e.isNew===1?"":a.UUID,enabled:e.enabled??0,key:e.key??"",value:e.value??"",description:e.description??"",fieldType:e.fieldType??""})),l={...o.getValues(),UUID:a.UUID,project:i.project,clientDatabase:i.UUID,apiTestHasDatas:c??[]},m=[a?.UUID].filter(e=>e!==void 0);a.isNew?await U({apiTestDTO:l,clientDatabaseToken:i.password},{onSuccess:e=>{r(d(m)),r(b(e)),r(n({action:null})),r(x(e.apiTestDTO))},onError:e=>{console.error(e),p("Error","Failed to create test case","error"),r(T()),r(n({action:null})),r(d(m))}}):await g({apiTestDTO:l,clientDatabaseToken:i.password},{onSuccess:e=>{r(d(m)),r(b(e)),r(n({action:null})),r(x(e.apiTestDTO)),o.reset({parentApiTest:e.parentApiTest??"",clientDatabase:e.clientDatabase??"",project:e.project??"",testName:e.testName??"",isFolder:e.isFolder??0,transmission:e.transmission??"",description:e.description??"",moreDescription:e.moreDescription??"",apiTestData:e.apiTestHasDatas?e?.apiTestHasDatas.map(N=>N.dto):[]})},onError:e=>{console.error(e),p("Error","Failed to create test case","error"),r(T()),r(n({action:null})),r(d(m))}})}else throw new Error("Missing Client Database Token")}catch(t){console.error(t);const c=t instanceof Error?t.message:typeof t=="string"?t:"Unexpected error occurred";p("Error",c,"error")}},S=t=>{console.error(o.getValues()),console.error("‚ùå Validation errors:",t)};return s.jsxs(H,{children:[s.jsx(A,{title:"API Test"}),s.jsx(q,{children:s.jsxs(Q,{...o,children:[s.jsx("div",{className:"w-60 border-none flex-shrink-0 mx-2",children:s.jsx(L,{})}),s.jsx("div",{className:"flex-1 flex flex-coloverflow-auto w-full",children:s.jsx("div",{className:"flex flex-1 space-x-2",children:s.jsx(B,{...o,children:s.jsxs("form",{onSubmit:o.handleSubmit(E,S),className:"flex flex-col gap-4 w-full",children:[s.jsx("div",{className:"border rounded-lg p-4 h-[400px] flex flex-col",children:s.jsx("div",{className:"flex-1 overflow-auto",children:s.jsx(P,{})})}),s.jsx("div",{className:"border rounded-lg p-4",children:s.jsx(_,{})})]})})})})]})})]})}export{Xe as default};
