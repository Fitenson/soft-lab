import{u as b}from"./useRequest-CWXKXklS.js";import{a6 as A}from"./main-C_fwfqY3.js";import{B as y}from"./BaseEntity-DGhPHkWu.js";import{a as g,A as j}from"./ApiTestViewModel-DBfoIpo7.js";import{h as l}from"./serviceHandler-BlQljMi1.js";import{C as I}from"./ClientDatabaseViewModel-CZz8IN5P.js";const f=["UUID","parentApiTest","clientDatabase","project","testName","transmission","description","isFolder","moreDescription"];function w(i,t){return A(i,f,t,"apiTest")}class d extends y{_UUID;_apiTest;_key;_value;_description;_enabled;_fieldType;_isNew;_isDelete;_seq;_apiTestDataDTO;constructor(t){super(t),this._UUID=t.UUID??"",this._apiTest=t.apiTest??"",this._key=t.key??"",this._value=t.value??"",this._description=t.description??"",this._enabled=Number(t.enabled),this._fieldType=btoa(t.fieldType??""),this._apiTestDataDTO=t,this._isNew=Number(t.isNew??0),this._seq=Number(t.seq??1),this._isDelete=Number(t.isDelete??0)}asViewModel(){return new g(this.asDto())}get UUID(){return this._UUID}set UUID(t){this._UUID=t}get apiTest(){return this._apiTest}set apiTest(t){this._apiTest=t}get key(){return this._key}set key(t){this._key=t}get value(){return this._value}set value(t){this._value=t}get description(){return this._description}set description(t){this._description=t}get enabled(){return Number(this._enabled)}set enabled(t){this._enabled=Number(t)}get fieldType(){return atob(this._fieldType)}set fieldType(t){this._fieldType=btoa(t)}get apiTestDataDTO(){return this._apiTestDataDTO}set apiTestDataDTO(t){this._apiTestDataDTO=t}get isNew(){return Number(this._isNew??0)}set isNew(t){this._isNew=Number(t??0)}get seq(){return this._seq}set seq(t){this._seq=t}get isDelete(){return Number(this._isDelete??0)}set isDelete(t){this._isDelete=Number(t??0)}}class h extends y{_UUID;_parentApiTest;_clientDatabase;_project;_testName;_isFolder;_transmission;_description;_moreDescription;_apiTestHasDatas;_apiTests;_isNew;constructor(t){super(t),this._UUID=t.UUID??"",this._parentApiTest=t.parentApiTest??"",this._clientDatabase=t.clientDatabase??"",this._project=t.project??"",this._testName=t.testName??"",this._isFolder=Number(t.isFolder??0),this._transmission=t.transmission??"",this._description=t.description??"",this._moreDescription=t.moreDescription??"",this._apiTestHasDatas=(t.apiTestHasDatas??[]).map(o=>new d(o)),this._apiTests=(t.apiTests??[]).map(o=>new h(o)),this._isNew=t.isNew??!1}asViewModel(){return new j({UUID:this._UUID,parentApiTest:this._parentApiTest,clientDatabase:this._clientDatabase,project:this._project,testName:this._testName,isFolder:this._isFolder,isNew:this._isNew,transmission:this._transmission,description:this._description,moreDescription:this._moreDescription,apiTests:this._apiTests,apiTestHasDatas:this._apiTestHasDatas})}get UUID(){return this._UUID}set UUID(t){this._UUID=t}get parentApiTest(){return this._parentApiTest}set parentApiTest(t){this._parentApiTest=t}get clientDatabase(){return this._clientDatabase}set clientDatabase(t){this._clientDatabase=t}get project(){return this._project}set project(t){this._project=t}get testName(){return this._testName}set testName(t){this._testName=t}get transmission(){return this._transmission}set transmission(t){this._transmission=t}get description(){return this._description}set description(t){this._description=t}get moreDescription(){return this._moreDescription}set moreDescription(t){this._moreDescription=t}get isFolder(){return this._isFolder}set isFolder(t){this._isFolder=t}get apiTests(){return this._apiTests}set apiTests(t){this._apiTests=t}get apiTestHasDatas(){return this._apiTestHasDatas}set apiTestHasDatas(t){this._apiTestHasDatas=t}get isNew(){return this._isNew}set isNew(t){this._isNew=t}}const H=["UUID","apiTest","fieldType","key","value","enabled","seq","description"];function U(i,t){const o=i.map(T=>({...T,UUID:T.isNew===1?"":T.UUID??""}));return A(o,H,t,"apiTestHasData")}const v=()=>{const{request:i}=b();return{listProjects:async()=>i({url:"/api-test/list-projects",method:"GET"}),indexApiTest:async()=>i({url:"/api-test/index",method:"GET"}),createApiTest:async({apiTestEntity:D,clientDatabaseToken:c})=>{const a=D.asDto(),_=w(a,new FormData);Array.isArray(a.apiTestHasDatas)&&a.apiTestHasDatas.length>0&&U(a.apiTestHasDatas,_);const s=await i({url:"/api-test/create",method:"POST",data:_,headers:{"X-Client-Database-Token":c}}),n=s.apiTest,p=s.apiTestHasData,e=new h(n);return e.apiTestHasDatas=p.map(r=>new d(r)),e},updateApiTest:async({apiTestEntity:D,clientDatabaseToken:c})=>{const a=D.asDto(),_=w(a,new FormData);Array.isArray(a.apiTestHasDatas)&&a.apiTestHasDatas.length>0&&U(a.apiTestHasDatas,_);const s=await i({url:`/api-test/update?id=${a.UUID}`,method:"POST",data:_,headers:{"X-Client-Database-Token":c}}),n=s.apiTest,p=s.apiTestHasData,e=new h(n);return e.apiTestHasDatas=p.map(r=>new d(r)),e},removeApiTest:async D=>{const c=new FormData;return D.forEach(a=>{c.append("UUIDs[]",a)}),await i({url:"/api-test/remove",method:"POST",data:c})}}};class O{_UUID;_projectCode;_projectName;_clientDatabases;constructor(t,o){this._UUID=t?.UUID??"",this._projectCode=t?.projectCode??"",this._projectName=t?.projectName??"",this._clientDatabases=o}get UUID(){return this._UUID}get projectCode(){return this._projectCode}get projectName(){return this._projectName}get clientDatabases(){return this._clientDatabases}}const C=()=>{const{listProjects:i,indexApiTest:t,createApiTest:o,updateApiTest:T,removeApiTest:m}=v();return{listProjects:async s=>l(async()=>{const n=await i(),p=n.rows.map(e=>{const r=e.clientDatabases.map(u=>new I(u));return new O(e,r)});return{...n,rows:p}},s),indexApiTest:async s=>l(async()=>await t(),s),createApiTest:async({apiTestDTO:s,clientDatabaseToken:n},p)=>{let e=new h(s);return e=await l(async()=>o({apiTestEntity:e,clientDatabaseToken:n}),{onSuccess:r=>{const u=r.asViewModel();p?.onSuccess?.(u)},onError:r=>{p?.onError?.(r)}}),e.asViewModel()},updateApiTest:async({apiTestDTO:s,clientDatabaseToken:n},p)=>{let e=new h(s);return e=await l(async()=>T({apiTestEntity:e,clientDatabaseToken:n}),{onSuccess:r=>{const u=r.asViewModel();p?.onSuccess?.(u)},onError:r=>{p?.onError?.(r)}}),e.asViewModel()},removeApiTest:async(s,n)=>await l(async()=>m(s),n)}};export{C as u};
