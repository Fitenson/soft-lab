import{S as V,l as I,m as R,n as A,o as x,p as U,a as r,q as K,v as q,u as N,j as c,r as P,w as M,b as L,c as k,d as Q}from"./main-DhGsVqqe.js";import{u as B,T as J,g as $,a as G,b as H}from"./top-action-bar-CLWUdiVl.js";import{u as g}from"./useAppSelector-qAMpT6Mk.js";import{U as O}from"./UserViewModel-BWSeG2eZ.js";import{u as W}from"./use-show-toast-D4V0YDqd.js";import{D as X}from"./data-table-R5R4ppRf.js";import Y from"./useUserService-CdIivkzC.js";import"./iconBase-BvsSv5c3.js";import"./button-B3Njs7VR.js";import"./utils-Ce4EbVqB.js";import"./index-DJxkHSX0.js";import"./createLucideIcon-BG6Ydya_.js";import"./input-CU5jspLQ.js";import"./serviceHandler-BlQljMi1.js";import"./useUserRepository-DqMiDY4B.js";import"./useRequest-zjc4zTBm.js";import"./BaseEntity-DGhPHkWu.js";var Z=class extends V{#s;#o=void 0;#t;#e;constructor(e,s){super(),this.#s=e,this.setOptions(s),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const s=this.options;this.options=this.#s.defaultMutationOptions(e),I(this.options,s)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),s?.mutationKey&&this.options.mutationKey&&R(s.mutationKey)!==R(this.options.mutationKey)?this.reset():this.#t?.state.status==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#t?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#n(e)}getCurrentResult(){return this.#o}reset(){this.#t?.removeObserver(this),this.#t=void 0,this.#i(),this.#n()}mutate(e,s){return this.#e=s,this.#t?.removeObserver(this),this.#t=this.#s.getMutationCache().build(this.#s,this.options),this.#t.addObserver(this),this.#t.execute(e)}#i(){const e=this.#t?.state??A();this.#o={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#n(e){x.batch(()=>{if(this.#e&&this.hasListeners()){const s=this.#o.variables,n=this.#o.context;e?.type==="success"?(this.#e.onSuccess?.(e.data,s,n),this.#e.onSettled?.(e.data,null,s,n)):e?.type==="error"&&(this.#e.onError?.(e.error,s,n),this.#e.onSettled?.(void 0,e.error,s,n))}this.listeners.forEach(s=>{s(this.#o)})})}};function _(e,s){const n=U(),[i]=r.useState(()=>new Z(n,e));r.useEffect(()=>{i.setOptions(e)},[i,e]);const a=r.useSyncExternalStore(r.useCallback(l=>i.subscribe(x.batchCalls(l)),[i]),()=>i.getCurrentResult(),()=>i.getCurrentResult()),h=r.useCallback((l,m)=>{i.mutate(l,m).catch(K)},[i]);if(a.error&&q(i.options.throwOnError,[a.error]))throw a.error;return{...a,mutate:h,mutateAsync:a.mutate}}function bt({columns:e,data:s,onRefresh:n}){const[i,a]=r.useState({}),[h,l]=r.useState([]),[m,z]=r.useState({startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,isResizingColumn:!1,columnSizingStart:[]}),u=N(),b=g(t=>t.loading.global),{rowSelection:S,sorting:w,columnVisibility:v}=g(t=>t.userDataTable),C=W(),E=U(),{params:d}=g(t=>t.userDataTable),{removeUser:D}=Y(),T=_({mutationFn:t=>{const o=t.map(p=>p.UUID);return D(o)},onSuccess:()=>{C("Success","Successfully remove the user","success"),E.invalidateQueries({queryKey:["/organization/user/index",d]})},onError:()=>{C("Error","Failed to delete user","error")}}),f=B({data:s,columns:e,columnResizeMode:"onChange",enableRowSelection:!0,enableMultiRowSelection:!0,enableColumnFilters:!0,onColumnSizingChange:a,onColumnSizingInfoChange:z,onRowSelectionChange:t=>{const o=typeof t=="function"?t(S):t;u(Q(o))},onSortingChange:t=>{const o=typeof t=="function"?t(w):t;u(k(o)),o.length>0&&u(M({...d,sort:o[0].id,order:o[0].desc?"desc":"asc"}))},onColumnVisibilityChange:t=>{const o=typeof t=="function"?t(v):t;u(L(o))},onColumnFiltersChange:t=>{const o=typeof t=="function"?t(h):t;l(o);const p=Object.fromEntries(o.map(y=>[y.id,y.value]));u(M({...d,filter:JSON.stringify(p)}))},getCoreRowModel:H(),getFilteredRowModel:G(),getSortedRowModel:$(),state:{rowSelection:S,sorting:w,columnVisibility:v,columnSizing:i,columnSizingInfo:m,columnFilters:h}}),j=t=>{const o=new O(t.original);P.visit(`/organization/user/view?id=${o.UUID}`)},F=()=>{const t=f.getSelectedRowModel().rows.map(o=>new O(o.original));T.mutate(t)};return c.jsx("main",{className:"w-full",children:c.jsxs("div",{className:"overflow-hidden rounded-md border",children:[c.jsx("div",{className:"w-full",children:c.jsx(J,{isLoading:b,createAction:{to:"/organization/user/create"},deleteAction:{action:F},refreshAction:{action:n},table:f})}),c.jsx(X,{table:f,isLoading:b,onSelectRow:j})]})})}export{bt as default};
