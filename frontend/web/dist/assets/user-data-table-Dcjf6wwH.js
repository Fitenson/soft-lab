import{S as D,l as T,m as g,n as j,o as w,p as v,a,q as I,v as V,u as A,j as c,r as K,b as q,c as F,d as L}from"./main-D5RGKBYJ.js";import{u as N,T as k,g as P,a as Q,b as B}from"./top-action-bar-Cdf6VidK.js";import{u as d}from"./useAppSelector-BDP3TAc3.js";import{U as S}from"./UserViewModel-BWSeG2eZ.js";import{u as $}from"./use-show-toast-CN3ZEo13.js";import{D as G}from"./data-table-DnpIGIcg.js";import H from"./useUserService-CVVZ2LLO.js";import"./button-tYiIYUx0.js";import"./utils-Ce4EbVqB.js";import"./dropdown-menu-B19Kqavm.js";import"./index-C0TucRMm.js";import"./createLucideIcon-C82_HNVK.js";import"./input-DpbN7Yd6.js";import"./serviceHandler-BlQljMi1.js";import"./useUserRepository-BE5mM1w4.js";import"./useRequest-BO6k6QAc.js";import"./BaseEntity-DGhPHkWu.js";var J=class extends D{#s;#o=void 0;#t;#e;constructor(t,s){super(),this.#s=t,this.setOptions(s),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(t){const s=this.options;this.options=this.#s.defaultMutationOptions(t),T(this.options,s)||this.#s.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#t,observer:this}),s?.mutationKey&&this.options.mutationKey&&g(s.mutationKey)!==g(this.options.mutationKey)?this.reset():this.#t?.state.status==="pending"&&this.#t.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#t?.removeObserver(this)}onMutationUpdate(t){this.#i(),this.#n(t)}getCurrentResult(){return this.#o}reset(){this.#t?.removeObserver(this),this.#t=void 0,this.#i(),this.#n()}mutate(t,s){return this.#e=s,this.#t?.removeObserver(this),this.#t=this.#s.getMutationCache().build(this.#s,this.options),this.#t.addObserver(this),this.#t.execute(t)}#i(){const t=this.#t?.state??j();this.#o={...t,isPending:t.status==="pending",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset}}#n(t){w.batch(()=>{if(this.#e&&this.hasListeners()){const s=this.#o.variables,n=this.#o.context;t?.type==="success"?(this.#e.onSuccess?.(t.data,s,n),this.#e.onSettled?.(t.data,null,s,n)):t?.type==="error"&&(this.#e.onError?.(t.error,s,n),this.#e.onSettled?.(void 0,t.error,s,n))}this.listeners.forEach(s=>{s(this.#o)})})}};function W(t,s){const n=v(),[o]=a.useState(()=>new J(n,t));a.useEffect(()=>{o.setOptions(t)},[o,t]);const r=a.useSyncExternalStore(a.useCallback(u=>o.subscribe(w.batchCalls(u)),[o]),()=>o.getCurrentResult(),()=>o.getCurrentResult()),h=a.useCallback((u,l)=>{o.mutate(u,l).catch(I)},[o]);if(r.error&&V(o.options.throwOnError,[r.error]))throw r.error;return{...r,mutate:h,mutateAsync:r.mutate}}function dt({columns:t,data:s,onRefresh:n}){const[o,r]=a.useState({}),[h,u]=a.useState({startOffset:null,startSize:null,deltaOffset:null,deltaPercentage:null,isResizingColumn:!1,columnSizingStart:[]}),l=A(),C=d(e=>e.loading),{rowSelection:p,sorting:f,columnVisibility:b}=d(e=>e.userDataTable),y=$(),R=v(),{params:M}=d(e=>e.userDataTable),{removeUser:O}=H(),x=W({mutationFn:e=>{const i=e.map(z=>z.UUID);return O(i)},onSuccess:()=>{R.invalidateQueries({queryKey:["/user/index",M]})},onError:()=>{y("Error","Failed to delete user","error")}}),m=N({data:s,columns:t,columnResizeMode:"onChange",enableRowSelection:!0,enableMultiRowSelection:!0,enableColumnFilters:!0,onColumnSizingChange:r,onColumnSizingInfoChange:u,onRowSelectionChange:e=>{const i=typeof e=="function"?e(p):e;l(L(i))},onSortingChange:e=>{const i=typeof e=="function"?e(f):e;l(F(i))},onColumnVisibilityChange:e=>{const i=typeof e=="function"?e(b):e;l(q(i))},getCoreRowModel:B(),getFilteredRowModel:Q(),getSortedRowModel:P(),state:{rowSelection:p,sorting:f,columnVisibility:b,columnSizing:o,columnSizingInfo:h}}),U=e=>{const i=new S(e.original);K.visit(`/user/view?id=${i.UUID}`)},E=()=>{const e=m.getSelectedRowModel().rows.map(i=>new S(i.original));x.mutate(e)};return c.jsx("main",{className:"w-full",children:c.jsxs("div",{className:"overflow-hidden rounded-md border",children:[c.jsx("div",{className:"w-full",children:c.jsx(k,{createAction:{to:"/user/create"},deleteAction:{action:E},refreshAction:{action:n},table:m})}),c.jsx(G,{table:m,isLoading:C.global,onSelectRow:U})]})})}export{dt as default};
