import{c as h,a as P,R as K,j as e,u as A,ar as B}from"./main-Bs3Kwuia.js";import{D as z,b as L,c as k,g as G}from"./dialog-BXRBJEn-.js";import{F as O,a as f,b as w,c as F,d as y,e as S}from"./form-CCxmgHSL.js";import{I as C}from"./input-CHigoYIF.js";import{u as H}from"./index.esm-Dalp2djR.js";import{C as Q}from"./ClientDatabaseViewModel-CZz8IN5P.js";import{a as X}from"./zod-BrSEatqy.js";import{o as J,s as D}from"./schemas-D95ZC4Tg.js";import{B as U}from"./button-D8qt724e.js";import{S as W}from"./save-button-K2RhQlOL.js";import{u as Y}from"./useClientDatabaseService-Cb2_lsq6.js";import{u as Z}from"./use-show-toast-CpO-ylZ-.js";import{u as _}from"./useAppSelector-D7YagSo4.js";import{G as $}from"./index-CTzIS4E-.js";import{u as ee,g as ae,a as re,b as oe}from"./index-D0txFJA3.js";import{P as se,a as te,b as ne}from"./popover-DYVXPwP1.js";import{D as me}from"./data-table-BhZKGm-C.js";import{c as u}from"./ColumnConfig-BcpwpaHs.js";import{C as N}from"./CommonField-fwNvoV4X.js";import{D as v}from"./DepartmentFormField-CGwo01HX.js";import{P as M}from"./ProjectFormField-BUThJuLu.js";import{u as le}from"./useRequest-BmthMcGV.js";import{h as ce}from"./serviceHandler-BlQljMi1.js";import{u as de}from"./useQuery-10s0ikwC.js";import{P as ie}from"./ProjectViewModel-CzJ36bb_.js";import{X as pe}from"./x-XXLv6-kj.js";import"./index-BKTkZj8o.js";import"./index-DUsqWs4o.js";import"./BaseEntity-DGhPHkWu.js";import"./table-aQkIK-Rz.js";import"./skeleton-C4V80aYP.js";import"./createLucideIcon-Bq6apdP2.js";import"./useAuthState-Btwrr8Uf.js";const a={databaseName:h({name:"databaseName",label:"Database Name",max:50}),databaseSchema:h({name:"databaseSchema",label:"Database Schema",max:50}),host:h({name:"host",label:"Host",max:50}),port:h({name:"port",label:"Port",max:50}),username:h({name:"username",label:"Username",max:50}),password:h({name:"password",label:"Password",max:50}),project:h({name:"project",label:"Project"}),projectName:h({name:"projectName",label:"Project"})},ue=J({databaseName:D().max(a.databaseName.max,{error:a.databaseName.maxError}),databaseSchema:D().max(a.databaseSchema.max,{error:a.databaseSchema.maxError}),host:D().max(a.host.max,{error:a.host.maxError}),port:D().max(a.port.max,{error:a.port.maxError}),username:D().max(a.username.max,{error:a.username.maxError}),password:D().max(a.password.max,{error:a.password.maxError}),project:D(),projectName:D()}),be=({clientDatabaseDTO:m})=>{const[s,t]=P.useState(()=>m?new Q(m):void 0),l=H({resolver:X(ue),defaultValues:{databaseName:s?.databaseName??"",databaseSchema:s?.databaseSchema??"",host:s?.host??"",port:s?.port??"",username:s?.username??"",password:s?.password??"",project:s?.project??"",projectName:s?.projectName??""}});return{form:l,setFormError:(c,b)=>{const{setToastError:i}=b||{},d=c,n=d?.response?.data?.errors??{};typeof n=="string"?i?.(n):n&&Object.keys(n).length>0?Object.keys(n).forEach(x=>{const p=x.replace(/^clientDatabase\./,"");p in l.getValues()&&l.setError(p,{type:"server",message:n[x][0]??"Invalid value"})}):i?.(d?.response?.data?.message??"Server error")},clientDatabaseViewModel:s,setClientDatabaseViewModel:t}};function xe(m){return $({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"},child:[]}]})(m)}function je({columns:m,data:s,isLoading:t,onSelect:l,label:r,value:c,onChange:b}){const[i,d]=K.useState(!1),n=ee({data:s,columns:m,columnResizeMode:"onChange",enableRowSelection:!0,enableColumnFilters:!0,getCoreRowModel:oe(),getFilteredRowModel:re(),getSortedRowModel:ae()}),x=p=>{b?.(p?.original),l?.(p.original),d(!1)};return e.jsxs(se,{open:i,onOpenChange:d,children:[e.jsx(te,{asChild:!0,children:e.jsxs(U,{variant:"outline",role:"combobox",className:"w-full justify-between",children:[c||r,e.jsx(xe,{})]})}),e.jsx(ne,{className:"w-[600px] p-2",children:e.jsx(me,{variant:"dropdown",table:n,isLoading:t,onSelectRow:x})})]})}u({accessorKey:v.departmentID.name,header:v.departmentID.label}),u({accessorKey:v.departmentID.name,header:v.departmentName.label}),u({accessorKey:v.headDepartmentName.name,header:v.headDepartmentName.label}),u({accessorKey:N.createdAtFormat.name,header:N.createdAtFormat.label}),u({accessorKey:N.createdByName.name,header:N.createdByName.label}),u({accessorKey:N.updatedAtFormat.name,header:N.updatedAtFormat.label}),u({accessorKey:N.updatedAtFormat.name,header:N.updatedAtFormat.label});const he=[u({header:M.projectCode.label,accessorKey:M.projectCode.name}),u({header:M.projectName.label,accessorKey:M.projectName.name})],fe=()=>{const{request:m}=le();async function s(t,l){const r=new FormData;return r.append("param[offset]",t.offset),r.append("param[limit]",t.limit),r.append("param[sort]",t.sort),r.append("param[order]",t.order),t.filter!=="{}"&&r.append("param[filter]",t.filter),l.forEach(c=>{r.append("table[]",c)}),m({url:"/universal/dropdown-table",method:"POST",data:r})}return{dropdownTable:s}},we=()=>{const{dropdownTable:m}=fe();async function s(t,l,r,c){return ce(async()=>{const b=await m(t,l),i={};for(const d of l){const n=b[d],x=r[d];i[d]={...n,rows:n.rows.map(p=>new x(p))}}return i},c)}return{dropdownTable:s}};function $e({clientDatabaseDTO:m,open:s,onOpenChange:t}){const l=A(),{form:r,setFormError:c,clientDatabaseViewModel:b,setClientDatabaseViewModel:i}=be({clientDatabaseDTO:m}),{createClientDatabase:d,updateClientDatabase:n}=Y(),{dropdownTable:x}=we(),p={offset:"0",limit:"20",sort:"createdAtFormat",order:"desc",filter:"{}"},{data:V,refetch:T}=de({queryKey:["/universal/dropdown-table",p],queryFn:async()=>await x(p,["project"],{project:ie}),enabled:!1});P.useEffect(()=>{T()},[T]);const I=Z(),g=_(o=>o.loading.global),q=async()=>{const E={...r.getValues(),...b?.UUID?{UUID:b.UUID}:{}};E?.UUID?await n(E,{onSuccess:j=>{i(j),t(!1)},onError:j=>{c(j,{setToastError(R){I("Error",R,"error")}})}}):await d(E,{onSuccess:j=>{l(B(j)),i(j),t(!1)},onError:j=>{c(j,{setToastError(R){I("Error",R,"error")}})}})};return e.jsx(z,{open:s,onOpenChange:t,children:e.jsx(L,{className:"sm:max-w-[720px]",showCloseButton:!1,children:e.jsx("div",{className:"w-full",children:e.jsx(O,{...r,children:e.jsxs("form",{className:"grid grid-cols-3 gap-4",onSubmit:r.handleSubmit(q),children:[e.jsxs(k,{className:"mb-4 col-span-3 flex flex-row items-center justify-start",children:[e.jsx(W,{}),e.jsx(G,{asChild:!0,children:e.jsx(U,{variant:"ghost",type:"button",className:"cursor-pointer rounded-full",children:e.jsx(pe,{className:"h-5 w-5 text-accent-foreground dark:text-accent-foreground"})})})]}),e.jsx(f,{control:r.control,name:a.databaseName.name,render:({field:o})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(F,{children:a.databaseName.label}),e.jsx(y,{children:e.jsx(C,{...o,disabled:g,required:!0})}),e.jsx(S,{})]})}),e.jsx(f,{control:r.control,name:a.databaseSchema.name,render:({field:o})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(F,{children:a.databaseSchema.label}),e.jsx(y,{children:e.jsx(C,{...o,disabled:g,required:!0})}),e.jsx(S,{})]})}),e.jsx(f,{control:r.control,name:a.host.name,render:({field:o})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(F,{children:a.host.label}),e.jsx(y,{children:e.jsx(C,{...o,disabled:g,required:!0})}),e.jsx(S,{})]})}),e.jsx(f,{control:r.control,name:a.port.name,render:({field:o})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(F,{children:a.port.label}),e.jsx(y,{children:e.jsx(C,{...o,disabled:g,required:!0})}),e.jsx(S,{})]})}),e.jsx(f,{control:r.control,name:a.username.name,render:({field:o})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(F,{children:a.username.label}),e.jsx(y,{children:e.jsx(C,{...o,disabled:g,required:!0})}),e.jsx(S,{})]})}),e.jsx(f,{control:r.control,name:a.password.name,render:({field:o})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(F,{children:a.password.label}),e.jsx(y,{children:e.jsx(C,{...o,disabled:g,required:!0})}),e.jsx(S,{})]})}),e.jsx(f,{name:a.project.name,render:({field:o})=>e.jsx(w,{className:"hidden",children:e.jsx(C,{...o})})}),e.jsx(f,{name:a.project.name,render:({field:o})=>e.jsxs(w,{children:[e.jsx(F,{children:a.projectName.label}),e.jsx(y,{children:e.jsx(je,{...o,columns:he,data:V?.project?.rows??[],isLoading:g,label:a.project.label,onSelect:E=>{o.onChange(E.projectName),r.setValue("project",E.UUID)}})}),e.jsx(S,{})]})})]})})})})})}export{$e as default};
