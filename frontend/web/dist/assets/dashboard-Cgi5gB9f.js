import{u as U,a as E,l as F,j as r,H as k,b,t as n,d,e as D,f as x,g as O}from"./main-DGN5mpaW.js";import{A as C}from"./app-layout-uFmhFFJM.js";import N from"./api-test-layout-FCRYEh2L.js";import I from"./test-case-sidebar-EJZz7s95.js";import q from"./test-case-form-eSJmY6aT.js";import L from"./test-case-output-6iKlYXLi.js";import{u as h}from"./useQuery-DenrDzU4.js";import{u as P}from"./useApiTestService-B42bMeXG.js";import{F as _}from"./index.esm-Blm62Et2.js";import{u as H}from"./documentation-tab-caCjxYJI.js";import{u as f}from"./useAppSelector-Dph1zFC5.js";import{s as K}from"./apiTestSelectors-BJyltacD.js";import{F as V}from"./form-BgLuWa9O.js";import{s as j}from"./clientDatabaseSelectors-BCEKIPh0.js";import{u as Q}from"./use-show-toast-C7zVwy_G.js";import{u as R}from"./useClientDatabaseService-DvSIkDOX.js";import"./button-CtPdyM7S.js";import"./index-DGcFUpkZ.js";import"./index-BPkJt45m.js";import"./x-B_SuPvAE.js";import"./createLucideIcon-C6BJ9PvY.js";import"./chevron-right-DhGUhisK.js";import"./dropdown-menu-BfV7xwn4.js";import"./index-rGWRJh_N.js";import"./index-Cn6xpbXL.js";import"./index-CL54NEBZ.js";import"./check-BT9zVP8v.js";import"./useAuthState-Dvm0fZyn.js";import"./index-KF43CNSJ.js";import"./tree-view-BdoMU21F.js";import"./input-DPyRlekn.js";import"./ApiTestFormField-D8ByCp8u.js";import"./ApiTestViewModel-CRkjMY33.js";import"./skeleton-CCRZ9_1l.js";import"./tabs-CyZn0-PM.js";import"./data-tab-BB9n6VbO.js";import"./select-BRjx-kdU.js";import"./api-test-data-table-RRLwIEiz.js";import"./index-D_B5YpTE.js";import"./table-DGC0Bthf.js";import"./ColumnConfig-DR8mfO1N.js";import"./ApiTestDataFormField-BQWEFUsU.js";import"./table-selection-popover-DGiDUS3y.js";import"./popover-DicmKF-j.js";import"./label-DvgNmBcm.js";import"./ClientDatabaseTableViewModel-CWID7VbN.js";import"./loader-circle-C5vmr0Xp.js";import"./scenario-tab-Dc3NQ2js.js";import"./useRequest-C9ailXQe.js";import"./BaseEntity-DGhPHkWu.js";import"./serviceHandler-BlQljMi1.js";import"./ClientDatabaseViewModel-CZz8IN5P.js";import"./zod-n2nOZF_y.js";import"./schemas-D95ZC4Tg.js";import"./textarea-DlQ-LXBB.js";function Be(){const e=U(),{indexApiTest:y,createApiTest:g,updateApiTest:w}=P(),a=f(K),i=f(j),T=f(j),{form:l}=H({apiTestDTO:a}),c=Q(),A={offset:"0",limit:"10",sort:"table",order:"asc",filter:""},{data:u}=h({queryKey:["/backend/api_test/index"],queryFn:async()=>await y(),enabled:!0});h({queryKey:["/backend/client_database/get-table-list"],queryFn:async()=>await v({params:A,clientDatabaseToken:T?.password??""},{callbacks:{onSuccess:s=>{const m={total:s.total,rows:s.rows.map(p=>p.dto)};e(O(m))},onError:s=>{c("Error","Failed to load client database tables","error"),console.error(s)}}}),enabled:!!T?.password});const{getTableList:v}=R();E.useEffect(()=>{u&&e(F(u))},[e,u]);const S=async()=>{try{if(a&&i&&i.password){const s=l.getValues("apiTestData").map(t=>({apiTest:a.UUID,enabled:t.enabled??0,key:t.key??"",value:t.value??"",description:t.description??"",fieldType:t.fieldType??""})),m={...l.getValues(),UUID:a.UUID,project:i.project,clientDatabase:i.UUID,apiTestData:s??[]},p=[a?.UUID].filter(t=>t!==void 0);a.isNew?await g({apiTestDTO:m,clientDatabaseToken:i.password},{onSuccess:t=>{e(d(p)),e(D(t)),e(n({action:null})),e(x(t.apiTestDTO))},onError:t=>{console.error(t),c("Error","Failed to create test case","error"),e(b()),e(n({action:null})),e(d(p))}}):await w({apiTestDTO:m,clientDatabaseToken:i.password},{onSuccess:t=>{e(d(p)),e(D(t)),e(n({action:null})),e(x(t.apiTestDTO))},onError:t=>{console.error(t),c("Error","Failed to create test case","error"),e(b()),e(n({action:null})),e(d(p))}})}else throw new Error("Missing Client Database Token")}catch(o){console.error(o);const s=o instanceof Error?o.message:typeof o=="string"?o:"Unexpected error occurred";c("Error",s,"error")}};return r.jsxs(C,{children:[r.jsx(k,{title:"API Test"}),r.jsx(N,{children:r.jsxs(_,{...l,children:[r.jsx("div",{className:"w-60 border-none flex-shrink-0 mx-2",children:r.jsx(I,{})}),r.jsx("div",{className:"flex-1 flex flex-coloverflow-auto w-full",children:r.jsx("div",{className:"flex flex-1 space-x-2",children:r.jsx(V,{...l,children:r.jsxs("form",{onSubmit:l.handleSubmit(S),className:"grid grid-cols-1 md:grid-cols-5 gap-2 w-full",children:[r.jsx("div",{className:"border rounded-lg p-4 md:col-span-3",children:r.jsx(q,{})}),r.jsx("div",{className:"border rounded-lg p-4 md:col-span-2",children:r.jsx(L,{})})]})})})})]})})]})}export{Be as default};
