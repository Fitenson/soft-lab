import{u as U,a as E,l as F,j as r,H as k,b,t as n,d,e as D,f as x,g as O}from"./main-CCsm7npd.js";import{A as C}from"./app-layout-CDDnAbdi.js";import N from"./api-test-layout-BKGSbW-i.js";import I from"./test-case-sidebar-BlYTG0Ms.js";import q from"./test-case-form-Bmoeu0ER.js";import L from"./test-case-output-DfZknezB.js";import{u as h}from"./useQuery-DZLNOFoW.js";import{u as P}from"./useApiTestService-C1XiIB9h.js";import{F as _}from"./index.esm-Diu_iA5A.js";import{u as H}from"./documentation-tab-DHdFJCN2.js";import{u as f}from"./useAppSelector-Ce2_yq9e.js";import{s as K}from"./apiTestSelectors-BJyltacD.js";import{F as V}from"./form-Dc9MwM7R.js";import{s as j}from"./clientDatabaseSelectors-BCEKIPh0.js";import{u as Q}from"./use-show-toast-CB-FkJHo.js";import{u as R}from"./useClientDatabaseService-5XV50gJA.js";import"./button-CUgnRfPS.js";import"./index-8n8AKqGF.js";import"./index-BlgXRo-Z.js";import"./x-D8OBOXlh.js";import"./createLucideIcon-CJh113ez.js";import"./chevron-right-pMLnMLqI.js";import"./dropdown-menu-D3PErr2Z.js";import"./index-BYPlzzcp.js";import"./index-CTl7kwxK.js";import"./index-X1yfwuVr.js";import"./check-Dfjodz5r.js";import"./useAuthState-CvXPHDgU.js";import"./index-Dfouv1QM.js";import"./tree-view-D5lgaIHX.js";import"./input-DuJlDC-O.js";import"./ApiTestFormField-BwH4WFgu.js";import"./ApiTestViewModel-CRkjMY33.js";import"./skeleton-B7i49Y4b.js";import"./tabs-iPUTFaWn.js";import"./data-tab-CIeorxJL.js";import"./select-DoMwqpvf.js";import"./api-test-data-table-Bg-L4fb7.js";import"./index-BXgblPEN.js";import"./table-CWp7DyFA.js";import"./ColumnConfig-CqB8Vezx.js";import"./ApiTestDataFormField-BAXKWOTx.js";import"./table-selection-popover-BzrwibZz.js";import"./popover-5RnXq6XN.js";import"./label-Dq9AYxZG.js";import"./ClientDatabaseTableViewModel-CWID7VbN.js";import"./loader-circle-Bd2zK--c.js";import"./scenario-tab-DZDZwK8c.js";import"./useRequest-DsaQCMbn.js";import"./BaseEntity-DGhPHkWu.js";import"./serviceHandler-BlQljMi1.js";import"./ClientDatabaseViewModel-CZz8IN5P.js";import"./zod-DQeGcrnp.js";import"./schemas-D95ZC4Tg.js";import"./textarea-BL9bNEAN.js";function Be(){const e=U(),{indexApiTest:y,createApiTest:g,updateApiTest:w}=P(),o=f(K),a=f(j),T=f(j),{form:i}=H({apiTestDTO:o}),l=Q(),A={offset:"0",limit:"10",sort:"table",order:"asc",filter:""},{data:u}=h({queryKey:["/backend/api_test/index"],queryFn:async()=>await y(),enabled:!0});h({queryKey:["/backend/client_database/get-table-list"],queryFn:async()=>{await v({params:A,clientDatabaseToken:T?.password??""},{callbacks:{onSuccess:s=>{const p={total:s.total,rows:s.rows.map(c=>c.dto)};e(O(p))},onError:s=>{l("Error","Failed to load client database tables","error"),console.error(s)}}})},enabled:!!T?.password});const{getTableList:v}=R();E.useEffect(()=>{u&&e(F(u))},[e,u]);const S=async()=>{try{if(o&&a&&a.password){const p=i.getValues("apiTestData").map(t=>({apiTest:o.UUID,enabled:t.enabled??0,key:t.key??"",value:t.value??"",description:t.description??"",fieldType:t.fieldType??""})),c={...i.getValues(),UUID:o.UUID,project:a.project,clientDatabase:a.UUID,apiTestData:p??[]},m=[o?.UUID].filter(t=>t!==void 0);o.isNew?await g({apiTestDTO:c,clientDatabaseToken:a.password},{onSuccess:t=>{e(d(m)),e(D(t)),e(n({action:null})),e(x(t.apiTestDTO))},onError:t=>{console.error(t),l("Error","Failed to create test case","error"),e(b()),e(n({action:null})),e(d(m))}}):await w({apiTestDTO:c,clientDatabaseToken:a.password},{onSuccess:t=>{e(d(m)),e(D(t)),e(n({action:null})),e(x(t.apiTestDTO))},onError:t=>{console.error(t),l("Error","Failed to create test case","error"),e(b()),e(n({action:null})),e(d(m))}})}else throw new Error("Missing Client Database Token")}catch(s){console.error(s);const p=s instanceof Error?s.message:typeof s=="string"?s:"Unexpected error occurred";l("Error",p,"error")}};return r.jsxs(C,{children:[r.jsx(k,{title:"API Test"}),r.jsx(N,{children:r.jsxs(_,{...i,children:[r.jsx("div",{className:"w-60 border-none flex-shrink-0 mx-2",children:r.jsx(I,{})}),r.jsx("div",{className:"flex-1 flex flex-coloverflow-auto w-full",children:r.jsx("div",{className:"flex flex-1 space-x-2",children:r.jsx(V,{...i,children:r.jsxs("form",{onSubmit:i.handleSubmit(S),className:"grid grid-cols-1 md:grid-cols-5 gap-2 w-full",children:[r.jsx("div",{className:"border rounded-lg p-4 md:col-span-3",children:r.jsx(q,{})}),r.jsx("div",{className:"border rounded-lg p-4 md:col-span-2",children:r.jsx(L,{})})]})})})})]})})]})}export{Be as default};
