import{u as k,a as O,l as I,j as s,H as A,b as T,t as n,d,e as b,f as x,g as C}from"./main-C_fwfqY3.js";import{A as H}from"./app-layout-Q0Y_dn7K.js";import q from"./api-test-layout-CQcF_cZn.js";import L from"./test-case-sidebar-jHOnJmJe.js";import P from"./test-case-form-DAdQs3As.js";import _ from"./test-case-output-2fo3xrlt.js";import{u as j}from"./useQuery-xVzWrTSS.js";import{u as K}from"./useApiTestService-BKHp8dVd.js";import{F as Q}from"./index.esm-CK6zZrtc.js";import{u as R}from"./documentation-tab-B0bLDxDv.js";import{u as f}from"./useAppSelector-C-V9AC7q.js";import{s as z}from"./apiTestSelectors-BJyltacD.js";import{F as B}from"./form-Cc8c0V50.js";import{s as g}from"./clientDatabaseSelectors-BCEKIPh0.js";import{u as G}from"./use-show-toast-BFR5ggrM.js";import{u as J}from"./useClientDatabaseService-CESSla6q.js";import"./button-CPpM9IBz.js";import"./index-CY5i6HM_.js";import"./index-DFd6x--S.js";import"./x-DnSbfBdB.js";import"./createLucideIcon-fsUv3rOc.js";import"./chevron-right-BzLGhp4-.js";import"./dropdown-menu-CY-cBaFY.js";import"./index-CuA5S3Rh.js";import"./index-Sijb_9q9.js";import"./index-DDt23tY-.js";import"./check-DEriUA6K.js";import"./useAuthState-Clzrvn1H.js";import"./index-CvNnpp5B.js";import"./tree-view-B_1HonXh.js";import"./input-BsjnPgH0.js";import"./ApiTestFormField-DlcmSv28.js";import"./ApiTestViewModel-DBfoIpo7.js";import"./skeleton-DzByNm7V.js";import"./tabs-C4kuLmCG.js";import"./data-tab-DMEEqD4-.js";import"./select-PHFdE6RW.js";import"./api-test-data-table-C9KBS0aa.js";import"./index-B6nWWRxU.js";import"./table-C8TG9Zji.js";import"./ColumnConfig-BvfoOiG4.js";import"./ApiTestDataFormField-CTcRmOlf.js";import"./table-selection-popover-S_gVBnLA.js";import"./popover-C-uLbcOh.js";import"./label-DtfSe9D3.js";import"./ClientDatabaseTableViewModel-CWID7VbN.js";import"./loader-circle-1N8YEGNG.js";import"./scenario-tab-BI39TuM0.js";import"./useRequest-CWXKXklS.js";import"./BaseEntity-DGhPHkWu.js";import"./serviceHandler-BlQljMi1.js";import"./ClientDatabaseViewModel-CZz8IN5P.js";import"./zod-DFdpIYYd.js";import"./schemas-D95ZC4Tg.js";import"./textarea-CwisDMvh.js";function Xr(){const t=k(),{indexApiTest:h,createApiTest:y,updateApiTest:U}=K(),a=f(z),i=f(g),D=f(g),{form:o}=R({apiTestDTO:a}),p=G(),F={offset:"0",limit:"10",sort:"table",order:"asc",filter:""},{data:u}=j({queryKey:["/backend/api_test/index"],queryFn:async()=>await h(),enabled:!0});j({queryKey:["/backend/client_database/get-table-list"],queryFn:async()=>{await v({params:F,clientDatabaseToken:D?.password??""},{callbacks:{onSuccess:e=>{const c={total:e.total,rows:e.rows.map(m=>m.dto)};t(C(c))},onError:e=>{p("Error","Failed to load client database tables","error"),console.error(e)}}})},enabled:!!D?.password});const{getTableList:v}=J();O.useEffect(()=>{u&&t(I(u))},[t,u]);const E=async()=>{try{if(a&&i&&i.password){const e=o.getValues("apiTestData");console.log("FormValues",e);const c=e.map(r=>({UUID:r.UUID,apiTest:r.isNew===1?"":a.UUID,enabled:r.enabled??0,key:r.key??"",value:r.value??"",description:r.description??"",fieldType:r.fieldType??""})),m={...o.getValues(),UUID:a.UUID,project:i.project,clientDatabase:i.UUID,apiTestHasDatas:c??[]},l=[a?.UUID].filter(r=>r!==void 0);a.isNew?await y({apiTestDTO:m,clientDatabaseToken:i.password},{onSuccess:r=>{t(d(l)),t(b(r)),t(n({action:null})),t(x(r.apiTestDTO))},onError:r=>{console.error(r),p("Error","Failed to create test case","error"),t(T()),t(n({action:null})),t(d(l))}}):await U({apiTestDTO:m,clientDatabaseToken:i.password},{onSuccess:r=>{t(d(l)),t(b(r)),t(n({action:null})),t(x(r.apiTestDTO)),o.reset({parentApiTest:r.parentApiTest??"",clientDatabase:r.clientDatabase??"",project:r.project??"",testName:r.testName??"",isFolder:r.isFolder??0,transmission:r.transmission??"",description:r.description??"",moreDescription:r.moreDescription??"",apiTestData:r.apiTestHasDatas?r?.apiTestHasDatas.map(N=>N.dto):[]})},onError:r=>{console.error(r),p("Error","Failed to create test case","error"),t(T()),t(n({action:null})),t(d(l))}})}else throw new Error("Missing Client Database Token")}catch(e){console.error(e);const c=e instanceof Error?e.message:typeof e=="string"?e:"Unexpected error occurred";p("Error",c,"error")}},S=e=>{console.error(o.getValues()),console.error("‚ùå Validation errors:",e)};return s.jsxs(H,{children:[s.jsx(A,{title:"API Test"}),s.jsx(q,{children:s.jsxs(Q,{...o,children:[s.jsx("div",{className:"w-60 border-none flex-shrink-0 mx-2",children:s.jsx(L,{})}),s.jsx("div",{className:"flex-1 flex flex-coloverflow-auto w-full",children:s.jsx("div",{className:"flex flex-1 space-x-2",children:s.jsx(B,{...o,children:s.jsxs("form",{onSubmit:o.handleSubmit(E,S),className:"grid grid-cols-1 md:grid-cols-5 gap-2 w-full",children:[s.jsx("div",{className:"border rounded-lg p-4 md:col-span-3",children:s.jsx(P,{})}),s.jsx("div",{className:"border rounded-lg p-4 md:col-span-2",children:s.jsx(_,{})})]})})})})]})})]})}export{Xr as default};
