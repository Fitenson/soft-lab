import{c as w,a as d,Y as U,v as ae,j as e,Z as te,w as se,x as ne,A as q,y as z,z as M,_ as B,P as L,B as ce,C as le,D as ie,$ as de,a1 as pe,g as me,R as ue}from"./main-8ncLdOiw.js";import{C as fe,u as xe,D as he,b as be,c as ve,g as je}from"./useClientDatabaseService-BlGF91EC.js";import{F as ge,a as C,b as R,c as D,d as F,e as N}from"./form-CQHYayYc.js";import{I as y}from"./input-VGNn6UV5.js";import{u as Pe,a as we}from"./zod-BZnfzYj_.js";import{o as Ce,s as E}from"./schemas-6m5s2bNq.js";import{B as G}from"./button-DPc0cG3y.js";import{u as Re,g as De,a as Fe,b as ye,S as Se}from"./index-WkhkQFPL.js";import{u as Ne}from"./use-show-toast-BOp3uBjr.js";import{u as Ee}from"./useAppSelector-4wajOo__.js";import{G as Ae}from"./index-BFGyWya7.js";import{h as Oe,R as Me,u as _e,F as Te,X as Ie}from"./index-DZFXR9TG.js";import{D as ke}from"./data-table-LpfJ_ZGB.js";import{c as b}from"./ColumnConfig-DK4jxHzo.js";import{C as v}from"./CommonField-fwNvoV4X.js";import{D as A}from"./DepartmentFormField-QIoj_pRi.js";import{P as T}from"./ProjectFormField-C0g-UiB0.js";import{u as Ve}from"./useRequest-B5_6hpkI.js";import{h as Ke}from"./serviceHandler-BlQljMi1.js";import{u as Ue}from"./useQuery-CsFZ04nl.js";import{P as qe}from"./ProjectViewModel-CzJ36bb_.js";import"./index-1fAJocyJ.js";import"./BaseEntity-DGhPHkWu.js";import"./createLucideIcon-BjEi-r8j.js";import"./useAuthState-DW_Sx6Rp.js";const l={databaseName:w({name:"databaseName",label:"Database Name",max:50}),databaseSchema:w({name:"databaseSchema",label:"Database Schema",max:50}),host:w({name:"host",label:"Host",max:50}),port:w({name:"port",label:"Port",max:50}),username:w({name:"username",label:"Username",max:50}),password:w({name:"password",label:"Password",max:50}),project:w({name:"project",label:"Project"})},ze=Ce({databaseName:E().max(l.databaseName.max,{error:l.databaseName.maxError}),databaseSchema:E().max(l.databaseSchema.max,{error:l.databaseSchema.maxError}),host:E().max(l.host.max,{error:l.host.maxError}),port:E().max(l.port.max,{error:l.port.maxError}),username:E().max(l.username.max,{error:l.username.maxError}),password:E().max(l.password.max,{error:l.password.maxError})}),Be=({clientDatabaseDTO:o})=>{const[s,a]=d.useState(()=>o?new fe(o):void 0),r=Pe({resolver:we(ze),defaultValues:{databaseName:s?.databaseName??"",databaseSchema:s?.databaseSchema??"",host:s?.host??"",port:s?.port??"",username:s?.username??"",password:s?.password??""}});return{form:r,setFormError:(n,c)=>{const{setToastError:i}=c||{},u=n,p=u?.response?.data?.errors??{};typeof p=="string"?i?.(p):p&&Object.keys(p).length>0?Object.keys(p).forEach(f=>{const x=f.replace(/^clientDatabase\./,"");x in r.getValues()&&r.setError(x,{type:"server",message:p[f][0]??"Invalid value"})}):i?.(u?.response?.data?.message??"Server error")},clientDatabaseViewModel:s,setClientDatabaseViewModel:a}};function Le(o){return Ae({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"},child:[]}]})(o)}var I="Popover",[$,Vo]=se(I,[U]),_=U(),[Ge,j]=$(I),H=o=>{const{__scopePopover:s,children:a,open:r,defaultOpen:t,onOpenChange:n,modal:c=!1}=o,i=_(s),u=d.useRef(null),[p,f]=d.useState(!1),[x,h]=ae({prop:r,defaultProp:t??!1,onChange:n,caller:I});return e.jsx(te,{...i,children:e.jsx(Ge,{scope:s,contentId:ne(),triggerRef:u,open:x,onOpenChange:h,onOpenToggle:d.useCallback(()=>h(S=>!S),[h]),hasCustomAnchor:p,onCustomAnchorAdd:d.useCallback(()=>f(!0),[]),onCustomAnchorRemove:d.useCallback(()=>f(!1),[]),modal:c,children:a})})};H.displayName=I;var Z="PopoverAnchor",$e=d.forwardRef((o,s)=>{const{__scopePopover:a,...r}=o,t=j(Z,a),n=_(a),{onCustomAnchorAdd:c,onCustomAnchorRemove:i}=t;return d.useEffect(()=>(c(),()=>i()),[c,i]),e.jsx(B,{...n,...r,ref:s})});$e.displayName=Z;var Q="PopoverTrigger",W=d.forwardRef((o,s)=>{const{__scopePopover:a,...r}=o,t=j(Q,a),n=_(a),c=q(s,t.triggerRef),i=e.jsx(z.button,{type:"button","aria-haspopup":"dialog","aria-expanded":t.open,"aria-controls":t.contentId,"data-state":oe(t.open),...r,ref:c,onClick:M(o.onClick,t.onOpenToggle)});return t.hasCustomAnchor?i:e.jsx(B,{asChild:!0,...n,children:i})});W.displayName=Q;var K="PopoverPortal",[He,Ze]=$(K,{forceMount:void 0}),X=o=>{const{__scopePopover:s,forceMount:a,children:r,container:t}=o,n=j(K,s);return e.jsx(He,{scope:s,forceMount:a,children:e.jsx(L,{present:a||n.open,children:e.jsx(ce,{asChild:!0,container:t,children:r})})})};X.displayName=K;var O="PopoverContent",Y=d.forwardRef((o,s)=>{const a=Ze(O,o.__scopePopover),{forceMount:r=a.forceMount,...t}=o,n=j(O,o.__scopePopover);return e.jsx(L,{present:r||n.open,children:n.modal?e.jsx(We,{...t,ref:s}):e.jsx(Xe,{...t,ref:s})})});Y.displayName=O;var Qe=le("PopoverContent.RemoveScroll"),We=d.forwardRef((o,s)=>{const a=j(O,o.__scopePopover),r=d.useRef(null),t=q(s,r),n=d.useRef(!1);return d.useEffect(()=>{const c=r.current;if(c)return Oe(c)},[]),e.jsx(Me,{as:Qe,allowPinchZoom:!0,children:e.jsx(J,{...o,ref:t,trapFocus:a.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:M(o.onCloseAutoFocus,c=>{c.preventDefault(),n.current||a.triggerRef.current?.focus()}),onPointerDownOutside:M(o.onPointerDownOutside,c=>{const i=c.detail.originalEvent,u=i.button===0&&i.ctrlKey===!0,p=i.button===2||u;n.current=p},{checkForDefaultPrevented:!1}),onFocusOutside:M(o.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1})})})}),Xe=d.forwardRef((o,s)=>{const a=j(O,o.__scopePopover),r=d.useRef(!1),t=d.useRef(!1);return e.jsx(J,{...o,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:n=>{o.onCloseAutoFocus?.(n),n.defaultPrevented||(r.current||a.triggerRef.current?.focus(),n.preventDefault()),r.current=!1,t.current=!1},onInteractOutside:n=>{o.onInteractOutside?.(n),n.defaultPrevented||(r.current=!0,n.detail.originalEvent.type==="pointerdown"&&(t.current=!0));const c=n.target;a.triggerRef.current?.contains(c)&&n.preventDefault(),n.detail.originalEvent.type==="focusin"&&t.current&&n.preventDefault()}})}),J=d.forwardRef((o,s)=>{const{__scopePopover:a,trapFocus:r,onOpenAutoFocus:t,onCloseAutoFocus:n,disableOutsidePointerEvents:c,onEscapeKeyDown:i,onPointerDownOutside:u,onFocusOutside:p,onInteractOutside:f,...x}=o,h=j(O,a),S=_(a);return _e(),e.jsx(Te,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:t,onUnmountAutoFocus:n,children:e.jsx(ie,{asChild:!0,disableOutsidePointerEvents:c,onInteractOutside:f,onEscapeKeyDown:i,onPointerDownOutside:u,onFocusOutside:p,onDismiss:()=>h.onOpenChange(!1),children:e.jsx(de,{"data-state":oe(h.open),role:"dialog",id:h.contentId,...S,...x,ref:s,style:{...x.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),ee="PopoverClose",Ye=d.forwardRef((o,s)=>{const{__scopePopover:a,...r}=o,t=j(ee,a);return e.jsx(z.button,{type:"button",...r,ref:s,onClick:M(o.onClick,()=>t.onOpenChange(!1))})});Ye.displayName=ee;var Je="PopoverArrow",eo=d.forwardRef((o,s)=>{const{__scopePopover:a,...r}=o,t=_(a);return e.jsx(pe,{...t,...r,ref:s})});eo.displayName=Je;function oe(o){return o?"open":"closed"}var oo=H,ro=W,ao=X,to=Y;function so({...o}){return e.jsx(oo,{"data-slot":"popover",...o})}function no({...o}){return e.jsx(ro,{"data-slot":"popover-trigger",...o})}function co({className:o,align:s="center",sideOffset:a=4,...r}){return e.jsx(ao,{children:e.jsx(to,{"data-slot":"popover-content",align:s,sideOffset:a,className:me("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",o),...r})})}function lo({columns:o,data:s,isLoading:a,onSelect:r,label:t}){const[n,c]=ue.useState(!1),i=Re({data:s,columns:o,columnResizeMode:"onChange",enableRowSelection:!0,enableColumnFilters:!0,getCoreRowModel:ye(),getFilteredRowModel:Fe(),getSortedRowModel:De()});return e.jsxs(so,{open:n,onOpenChange:c,children:[e.jsx(no,{asChild:!0,children:e.jsxs(G,{variant:"outline",role:"combobox",className:"w-full justify-between",children:[t,e.jsx(Le,{})]})}),e.jsx(co,{className:"w-[600px] p-2",children:e.jsx(ke,{table:i,isLoading:a,onSelectRow:r})})]})}b({accessorKey:A.departmentID.name,header:A.departmentID.label}),b({accessorKey:A.departmentID.name,header:A.departmentName.label}),b({accessorKey:A.headDepartmentName.name,header:A.headDepartmentName.label}),b({accessorKey:v.createdAtFormat.name,header:v.createdAtFormat.label}),b({accessorKey:v.createdByName.name,header:v.createdByName.label}),b({accessorKey:v.updatedAtFormat.name,header:v.updatedAtFormat.label}),b({accessorKey:v.updatedAtFormat.name,header:v.updatedAtFormat.label});const io=[b({header:T.projectCode.label,accessorKey:T.projectCode.name}),b({header:T.projectName.label,accessorKey:T.projectName.name})],po=()=>{const{request:o}=Ve();async function s(a,r){const t=new FormData;return t.append("param[offset]",a.offset),t.append("param[limit]",a.limit),t.append("param[sort]",a.sort),t.append("param[order]",a.order),a.filter!=="{}"&&t.append("param[filter]",a.filter),r.forEach(n=>{t.append("table[]",n)}),o({url:"/universal/dropdown-table",method:"POST",data:t})}return{dropdownTable:s}},mo=()=>{const{dropdownTable:o}=po();async function s(a,r,t,n){return Ke(async()=>{const c=await o(a,r),i={};for(const u of r){const p=c[u],f=t[u];i[u]={...p,rows:p.rows.map(x=>new f(x))}}return i},n)}return{dropdownTable:s}};function Ko({clientDatabaseDTO:o,open:s,onOpenChange:a}){const{form:r,setFormError:t,clientDatabaseViewModel:n,setClientDatabaseViewModel:c}=Be({clientDatabaseDTO:o}),{createClientDatabase:i,updateClientDatabase:u}=xe(),{dropdownTable:p}=mo(),f={offset:"0",limit:"20",sort:"createdAtFormat",order:"desc",filter:"{}"},{data:x,refetch:h}=Ue({queryKey:["/universal/dropdown-table",f],queryFn:async()=>await p(f,["project"],{project:qe}),enabled:!1});d.useEffect(()=>{h()},[h]);const S=Ne(),g=Ee(m=>m.loading.global),re=async()=>{const k={...r.getValues(),...n?.UUID?{UUID:n.UUID}:{}};k?.UUID?await u(k,{onSuccess:P=>{c(P),a(!1)},onError:P=>{t(P,{setToastError(V){S("Error",V,"error")}})}}):await i(k,{onSuccess:P=>{c(P),a(!1)},onError:P=>{t(P,{setToastError(V){S("Error",V,"error")}})}})};return e.jsx(he,{open:s,onOpenChange:a,children:e.jsx(be,{className:"sm:max-w-[720px]",showCloseButton:!1,children:e.jsx("div",{className:"w-full",children:e.jsx(ge,{...r,children:e.jsxs("form",{className:"grid grid-cols-3 gap-4",onSubmit:r.handleSubmit(re),children:[e.jsxs(ve,{className:"mb-4 col-span-3 flex flex-row items-center justify-start",children:[e.jsx(Se,{}),e.jsx(je,{asChild:!0,children:e.jsx(G,{variant:"ghost",type:"button",className:"cursor-pointer rounded-full",children:e.jsx(Ie,{className:"h-5 w-5 text-accent-foreground dark:text-accent-foreground"})})})]}),e.jsx(C,{control:r.control,name:l.databaseName.name,render:({field:m})=>e.jsxs(R,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.databaseName.label}),e.jsx(F,{children:e.jsx(y,{...m,disabled:g,required:!0})}),e.jsx(N,{})]})}),e.jsx(C,{control:r.control,name:l.databaseSchema.name,render:({field:m})=>e.jsxs(R,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.databaseSchema.label}),e.jsx(F,{children:e.jsx(y,{...m,disabled:g,required:!0})}),e.jsx(N,{})]})}),e.jsx(C,{control:r.control,name:l.host.name,render:({field:m})=>e.jsxs(R,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.host.label}),e.jsx(F,{children:e.jsx(y,{...m,disabled:g,required:!0})}),e.jsx(N,{})]})}),e.jsx(C,{control:r.control,name:l.port.name,render:({field:m})=>e.jsxs(R,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.port.label}),e.jsx(F,{children:e.jsx(y,{...m,disabled:g,required:!0})}),e.jsx(N,{})]})}),e.jsx(C,{control:r.control,name:l.username.name,render:({field:m})=>e.jsxs(R,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.username.label}),e.jsx(F,{children:e.jsx(y,{...m,disabled:g,required:!0})}),e.jsx(N,{})]})}),e.jsx(C,{control:r.control,name:l.password.name,render:({field:m})=>e.jsxs(R,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.password.label}),e.jsx(F,{children:e.jsx(y,{...m,disabled:g,required:!0})}),e.jsx(N,{})]})}),e.jsx(C,{name:l.project.name,render:({field:m})=>e.jsxs(R,{children:[e.jsx(D,{children:l.project.label}),e.jsx(lo,{columns:io,data:x?.project?.rows??[],isLoading:g,onSelect:()=>{},label:l.project.label}),e.jsx(F,{children:e.jsx(y,{...m})})]})})]})})})})})}export{Ko as default};
