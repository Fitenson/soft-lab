import{c as C,a as m,Y as k,v as Q,j as e,Z as ee,w as oe,x as re,A as K,y as V,z as A,_ as U,P as z,B as ae,C as te,D as se,$ as ne,a1 as ce,g as le,R as ie}from"./main-CBINz5c_.js";import{C as de,u as me,D as pe,b as ue,c as fe,g as xe}from"./useClientDatabaseService-BuWMubIG.js";import{F as he,a as P,b as w,c as R,d as D,e as N}from"./form-Lhww2A9Z.js";import{I as F}from"./input-vYfhWzWJ.js";import{u as be,a as ve}from"./zod-S5MlTV3G.js";import{o as ge,s as S}from"./schemas-6m5s2bNq.js";import{B}from"./button-CMOImiFK.js";import{u as je,g as Ce,a as Pe,b as we,S as Re}from"./index-PBiQoBo1.js";import{u as De}from"./use-show-toast-XQjFf_i4.js";import{u as Fe}from"./useAppSelector-CncuUHrP.js";import{G as Ne}from"./index-Ds2eI3to.js";import{h as Se,R as ye,u as Ee,F as Ae,X as Oe}from"./index-BWQSryqw.js";import{D as Me}from"./data-table-CNCIQRdH.js";import{c as h}from"./ColumnConfig-DizUj2Tn.js";import{C as b}from"./CommonField-fwNvoV4X.js";import{D as y}from"./DepartmentFormField-CCQST8vY.js";import{P as M}from"./ProjectFormField-IRO8x0NC.js";import"./index-D6NOxxNH.js";import"./serviceHandler-BlQljMi1.js";import"./useRequest-CGyahQAc.js";import"./useAuthState-qELdbL7k.js";import"./BaseEntity-DGhPHkWu.js";import"./createLucideIcon-Ch7zbsSd.js";const c={databaseName:C({name:"databaseName",label:"Database Name",max:50}),databaseSchema:C({name:"databaseSchema",label:"Database Schema",max:50}),host:C({name:"host",label:"Host",max:50}),port:C({name:"port",label:"Port",max:50}),username:C({name:"username",label:"Username",max:50}),password:C({name:"password",label:"Password",max:50}),project:C({name:"project",label:"Project"})},_e=ge({databaseName:S().max(c.databaseName.max,{error:c.databaseName.maxError}),databaseSchema:S().max(c.databaseSchema.max,{error:c.databaseSchema.maxError}),host:S().max(c.host.max,{error:c.host.maxError}),port:S().max(c.port.max,{error:c.port.maxError}),username:S().max(c.username.max,{error:c.username.maxError}),password:S().max(c.password.max,{error:c.password.maxError})}),Ie=({clientDatabaseDTO:o})=>{const[a,t]=m.useState(()=>o?new de(o):void 0),r=be({resolver:ve(_e),defaultValues:{databaseName:a?.databaseName??"",databaseSchema:a?.databaseSchema??"",host:a?.host??"",port:a?.port??"",username:a?.username??"",password:a?.password??""}});return{form:r,setFormError:(s,l)=>{const{setToastError:d}=l||{},f=s,p=f?.response?.data?.errors??{};typeof p=="string"?d?.(p):p&&Object.keys(p).length>0?Object.keys(p).forEach(u=>{const x=u.replace(/^clientDatabase\./,"");x in r.getValues()&&r.setError(x,{type:"server",message:p[u][0]??"Invalid value"})}):d?.(f?.response?.data?.message??"Server error")},clientDatabaseViewModel:a,setClientDatabaseViewModel:t}};function Te(o){return Ne({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"},child:[]}]})(o)}var _="Popover",[L,Fo]=oe(_,[k]),O=k(),[ke,v]=L(_),q=o=>{const{__scopePopover:a,children:t,open:r,defaultOpen:n,onOpenChange:s,modal:l=!1}=o,d=O(a),f=m.useRef(null),[p,u]=m.useState(!1),[x,i]=Q({prop:r,defaultProp:n??!1,onChange:s,caller:_});return e.jsx(ee,{...d,children:e.jsx(ke,{scope:a,contentId:re(),triggerRef:f,open:x,onOpenChange:i,onOpenToggle:m.useCallback(()=>i(g=>!g),[i]),hasCustomAnchor:p,onCustomAnchorAdd:m.useCallback(()=>u(!0),[]),onCustomAnchorRemove:m.useCallback(()=>u(!1),[]),modal:l,children:t})})};q.displayName=_;var G="PopoverAnchor",Ke=m.forwardRef((o,a)=>{const{__scopePopover:t,...r}=o,n=v(G,t),s=O(t),{onCustomAnchorAdd:l,onCustomAnchorRemove:d}=n;return m.useEffect(()=>(l(),()=>d()),[l,d]),e.jsx(U,{...s,...r,ref:a})});Ke.displayName=G;var $="PopoverTrigger",H=m.forwardRef((o,a)=>{const{__scopePopover:t,...r}=o,n=v($,t),s=O(t),l=K(a,n.triggerRef),d=e.jsx(V.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":J(n.open),...r,ref:l,onClick:A(o.onClick,n.onOpenToggle)});return n.hasCustomAnchor?d:e.jsx(U,{asChild:!0,...s,children:d})});H.displayName=$;var T="PopoverPortal",[Ve,Ue]=L(T,{forceMount:void 0}),Z=o=>{const{__scopePopover:a,forceMount:t,children:r,container:n}=o,s=v(T,a);return e.jsx(Ve,{scope:a,forceMount:t,children:e.jsx(z,{present:t||s.open,children:e.jsx(ae,{asChild:!0,container:n,children:r})})})};Z.displayName=T;var E="PopoverContent",W=m.forwardRef((o,a)=>{const t=Ue(E,o.__scopePopover),{forceMount:r=t.forceMount,...n}=o,s=v(E,o.__scopePopover);return e.jsx(z,{present:r||s.open,children:s.modal?e.jsx(Be,{...n,ref:a}):e.jsx(Le,{...n,ref:a})})});W.displayName=E;var ze=te("PopoverContent.RemoveScroll"),Be=m.forwardRef((o,a)=>{const t=v(E,o.__scopePopover),r=m.useRef(null),n=K(a,r),s=m.useRef(!1);return m.useEffect(()=>{const l=r.current;if(l)return Se(l)},[]),e.jsx(ye,{as:ze,allowPinchZoom:!0,children:e.jsx(X,{...o,ref:n,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:A(o.onCloseAutoFocus,l=>{l.preventDefault(),s.current||t.triggerRef.current?.focus()}),onPointerDownOutside:A(o.onPointerDownOutside,l=>{const d=l.detail.originalEvent,f=d.button===0&&d.ctrlKey===!0,p=d.button===2||f;s.current=p},{checkForDefaultPrevented:!1}),onFocusOutside:A(o.onFocusOutside,l=>l.preventDefault(),{checkForDefaultPrevented:!1})})})}),Le=m.forwardRef((o,a)=>{const t=v(E,o.__scopePopover),r=m.useRef(!1),n=m.useRef(!1);return e.jsx(X,{...o,ref:a,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{o.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||t.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,n.current=!1},onInteractOutside:s=>{o.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const l=s.target;t.triggerRef.current?.contains(l)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&n.current&&s.preventDefault()}})}),X=m.forwardRef((o,a)=>{const{__scopePopover:t,trapFocus:r,onOpenAutoFocus:n,onCloseAutoFocus:s,disableOutsidePointerEvents:l,onEscapeKeyDown:d,onPointerDownOutside:f,onFocusOutside:p,onInteractOutside:u,...x}=o,i=v(E,t),g=O(t);return Ee(),e.jsx(Ae,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:n,onUnmountAutoFocus:s,children:e.jsx(se,{asChild:!0,disableOutsidePointerEvents:l,onInteractOutside:u,onEscapeKeyDown:d,onPointerDownOutside:f,onFocusOutside:p,onDismiss:()=>i.onOpenChange(!1),children:e.jsx(ne,{"data-state":J(i.open),role:"dialog",id:i.contentId,...g,...x,ref:a,style:{...x.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Y="PopoverClose",qe=m.forwardRef((o,a)=>{const{__scopePopover:t,...r}=o,n=v(Y,t);return e.jsx(V.button,{type:"button",...r,ref:a,onClick:A(o.onClick,()=>n.onOpenChange(!1))})});qe.displayName=Y;var Ge="PopoverArrow",$e=m.forwardRef((o,a)=>{const{__scopePopover:t,...r}=o,n=O(t);return e.jsx(ce,{...n,...r,ref:a})});$e.displayName=Ge;function J(o){return o?"open":"closed"}var He=q,Ze=H,We=Z,Xe=W;function Ye({...o}){return e.jsx(He,{"data-slot":"popover",...o})}function Je({...o}){return e.jsx(Ze,{"data-slot":"popover-trigger",...o})}function Qe({className:o,align:a="center",sideOffset:t=4,...r}){return e.jsx(We,{children:e.jsx(Xe,{"data-slot":"popover-content",align:a,sideOffset:t,className:le("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",o),...r})})}function eo({columns:o,data:a,isLoading:t,onSelect:r,label:n}){const[s,l]=ie.useState(!1),d=je({data:a,columns:o,columnResizeMode:"onChange",enableRowSelection:!0,enableColumnFilters:!0,getCoreRowModel:we(),getFilteredRowModel:Pe(),getSortedRowModel:Ce()});return e.jsxs(Ye,{open:s,onOpenChange:l,children:[e.jsx(Je,{asChild:!0,children:e.jsxs(B,{variant:"outline",role:"combobox",className:"w-full justify-between",children:[n,e.jsx(Te,{})]})}),e.jsx(Qe,{className:"w-[600px] p-2",children:e.jsx(Me,{table:d,isLoading:t,onSelectRow:r})})]})}h({accessorKey:y.departmentID.name,header:y.departmentID.label}),h({accessorKey:y.departmentID.name,header:y.departmentName.label}),h({accessorKey:y.headDepartmentName.name,header:y.headDepartmentName.label}),h({accessorKey:b.createdAtFormat.name,header:b.createdAtFormat.label}),h({accessorKey:b.createdByName.name,header:b.createdByName.label}),h({accessorKey:b.updatedAtFormat.name,header:b.updatedAtFormat.label}),h({accessorKey:b.updatedAtFormat.name,header:b.updatedAtFormat.label});const oo=[h({header:M.projectCode.label,accessorKey:M.projectCode.name}),h({header:M.projectName.label,accessorKey:M.projectName.name})];function No({clientDatabaseDTO:o,open:a,onOpenChange:t}){const{form:r,setFormError:n,clientDatabaseViewModel:s,setClientDatabaseViewModel:l}=Ie({clientDatabaseDTO:o}),{createClientDatabase:d,updateClientDatabase:f}=me(),p=De(),u=Fe(i=>i.loading.global),x=async()=>{const g={...r.getValues(),...s?.UUID?{UUID:s.UUID}:{}};g?.UUID?await f(g,{onSuccess:j=>{l(j),t(!1)},onError:j=>{n(j,{setToastError(I){p("Error",I,"error")}})}}):await d(g,{onSuccess:j=>{l(j),t(!1)},onError:j=>{n(j,{setToastError(I){p("Error",I,"error")}})}})};return e.jsx(pe,{open:a,onOpenChange:t,children:e.jsx(ue,{className:"sm:max-w-[720px]",showCloseButton:!1,children:e.jsx("div",{className:"w-full",children:e.jsx(he,{...r,children:e.jsxs("form",{className:"grid grid-cols-3 gap-4",onSubmit:r.handleSubmit(x),children:[e.jsxs(fe,{className:"mb-4 col-span-3 flex flex-row items-center justify-start",children:[e.jsx(Re,{}),e.jsx(xe,{asChild:!0,children:e.jsx(B,{variant:"ghost",type:"button",className:"cursor-pointer rounded-full",children:e.jsx(Oe,{className:"h-5 w-5 text-accent-foreground dark:text-accent-foreground"})})})]}),e.jsx(P,{control:r.control,name:c.databaseName.name,render:({field:i})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(R,{children:c.databaseName.label}),e.jsx(D,{children:e.jsx(F,{...i,disabled:u,required:!0})}),e.jsx(N,{})]})}),e.jsx(P,{control:r.control,name:c.databaseSchema.name,render:({field:i})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(R,{children:c.databaseSchema.label}),e.jsx(D,{children:e.jsx(F,{...i,disabled:u,required:!0})}),e.jsx(N,{})]})}),e.jsx(P,{control:r.control,name:c.host.name,render:({field:i})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(R,{children:c.host.label}),e.jsx(D,{children:e.jsx(F,{...i,disabled:u,required:!0})}),e.jsx(N,{})]})}),e.jsx(P,{control:r.control,name:c.port.name,render:({field:i})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(R,{children:c.port.label}),e.jsx(D,{children:e.jsx(F,{...i,disabled:u,required:!0})}),e.jsx(N,{})]})}),e.jsx(P,{control:r.control,name:c.username.name,render:({field:i})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(R,{children:c.username.label}),e.jsx(D,{children:e.jsx(F,{...i,disabled:u,required:!0})}),e.jsx(N,{})]})}),e.jsx(P,{control:r.control,name:c.password.name,render:({field:i})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(R,{children:c.password.label}),e.jsx(D,{children:e.jsx(F,{...i,disabled:u,required:!0})}),e.jsx(N,{})]})}),e.jsx(P,{name:c.project.name,render:({field:i})=>e.jsxs(w,{children:[e.jsx(R,{children:c.project.label}),e.jsx(eo,{columns:oo,data:[],isLoading:u,onSelect:()=>{},label:c.project.label}),e.jsx(D,{children:e.jsx(F,{...i})})]})})]})})})})})}export{No as default};
