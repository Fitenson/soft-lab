import{u as k,a as N,l as O,j as e,H as C,b as T,t as n,d,e as b,f as x,g as A}from"./main-CTqjNw_1.js";import{A as I}from"./app-layout-Db8K_gQt.js";import q from"./api-test-layout-DAPbQ-ld.js";import H from"./test-case-sidebar-kTDjLbO1.js";import L from"./test-case-form-BMlyn8c7.js";import P from"./test-case-output-DVJDgdHx.js";import{u as j}from"./useQuery-BmW0PXEa.js";import{u as _}from"./useApiTestService-BSbv1coJ.js";import{F as K}from"./index.esm-yWvBp1Bw.js";import{u as Q}from"./documentation-tab-D3TZyXZA.js";import{u as f}from"./useAppSelector-CajmzB0M.js";import{s as R}from"./apiTestSelectors-BJyltacD.js";import{F as z}from"./form-DKo2ZhVV.js";import{s as h}from"./clientDatabaseSelectors-BCEKIPh0.js";import{u as B}from"./use-show-toast-CvPeqUC7.js";import{u as G}from"./useClientDatabaseService-CjYil-01.js";import"./button-D7O1ICWX.js";import"./index-Dunr3axe.js";import"./index-C7ol3PDU.js";import"./x-DZfc4hlH.js";import"./createLucideIcon-2IL8zAdl.js";import"./chevron-right-CJuFua6t.js";import"./dropdown-menu-BvP1F5rL.js";import"./index-BMK0GpLi.js";import"./index-8dUMp5rv.js";import"./index-Bjhkobib.js";import"./check-Bg_uiSoa.js";import"./useAuthState-B8IV6X9T.js";import"./index-DQNczF6k.js";import"./tree-view-CRJhS4Wk.js";import"./input-DHBdGodr.js";import"./ApiTestFormField-DjPdq18p.js";import"./ApiTestViewModel-DxDSkLkd.js";import"./skeleton-DxtYuBVh.js";import"./tabs-fA2cUtug.js";import"./data-tab-SDuBoqL-.js";import"./select-_dgOU_uZ.js";import"./api-test-data-table-DMcCLzdJ.js";import"./index-CnNRcPLH.js";import"./table-BewgXXBq.js";import"./ColumnConfig-YjGSvveN.js";import"./ApiTestDataFormField-ByY0ei_5.js";import"./table-selection-popover-BZpy3OWt.js";import"./popover-Cupe1OSJ.js";import"./label-CPEOG6gq.js";import"./ClientDatabaseTableViewModel-CWID7VbN.js";import"./loader-circle-Bwy7VCbj.js";import"./scenario-tab-DcsdGhe7.js";import"./useRequest-DP_WvtCY.js";import"./BaseEntity-DGhPHkWu.js";import"./serviceHandler-BlQljMi1.js";import"./ClientDatabaseViewModel-CZz8IN5P.js";import"./zod-CJSq7gEa.js";import"./schemas-D95ZC4Tg.js";import"./textarea-Zi6EHO3B.js";function Wt(){const r=k(),{indexApiTest:g,createApiTest:y,updateApiTest:v}=_(),a=f(R),o=f(h),D=f(h),{form:i}=Q({apiTestDTO:a}),c=B(),F={offset:"0",limit:"10",sort:"table",order:"asc",filter:""},{data:u}=j({queryKey:["/backend/api_test/index"],queryFn:async()=>await g(),enabled:!0});j({queryKey:["/backend/client_database/get-table-list"],queryFn:async()=>{await S({params:F,clientDatabaseToken:D?.password??""},{callbacks:{onSuccess:s=>{const p={total:s.total,rows:s.rows.map(m=>m.dto)};r(A(p))},onError:s=>{c("Error","Failed to load client database tables","error"),console.error(s)}}})},enabled:!!D?.password});const{getTableList:S}=G();N.useEffect(()=>{u&&r(O(u))},[r,u]);const U=async()=>{try{if(a&&o&&o.password){const p=i.getValues("apiTestData").map(t=>({apiTest:a.UUID,enabled:t.enabled??"0",key:t.key??"",value:t.value??"",description:t.description??"",fieldType:t.fieldType??""})),m={...i.getValues(),UUID:a.UUID,project:o.project,clientDatabase:o.UUID,apiTestHasDatas:p??[]},l=[a?.UUID].filter(t=>t!==void 0);a.isNew?await y({apiTestDTO:m,clientDatabaseToken:o.password},{onSuccess:t=>{r(d(l)),r(b(t)),r(n({action:null})),r(x(t.apiTestDTO))},onError:t=>{console.error(t),c("Error","Failed to create test case","error"),r(T()),r(n({action:null})),r(d(l))}}):await v({apiTestDTO:m,clientDatabaseToken:o.password},{onSuccess:t=>{r(d(l)),r(b(t)),r(n({action:null})),r(x(t.apiTestDTO)),console.log("ViewModel: ",t),i.reset({parentApiTest:t.parentApiTest??"",clientDatabase:t.clientDatabase??"",project:t.project??"",testName:t.testName??"",isFolder:t.isFolder??0,transmission:t.transmission??"",description:t.description??"",moreDescription:t.moreDescription??"",apiTestData:t.apiTestData?t?.apiTestData.map(E=>E.dto):[]})},onError:t=>{console.error(t),c("Error","Failed to create test case","error"),r(T()),r(n({action:null})),r(d(l))}})}else throw new Error("Missing Client Database Token")}catch(s){console.error(s);const p=s instanceof Error?s.message:typeof s=="string"?s:"Unexpected error occurred";c("Error",p,"error")}};return e.jsxs(I,{children:[e.jsx(C,{title:"API Test"}),e.jsx(q,{children:e.jsxs(K,{...i,children:[e.jsx("div",{className:"w-60 border-none flex-shrink-0 mx-2",children:e.jsx(H,{})}),e.jsx("div",{className:"flex-1 flex flex-coloverflow-auto w-full",children:e.jsx("div",{className:"flex flex-1 space-x-2",children:e.jsx(z,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(U),className:"grid grid-cols-1 md:grid-cols-5 gap-2 w-full",children:[e.jsx("div",{className:"border rounded-lg p-4 md:col-span-3",children:e.jsx(L,{})}),e.jsx("div",{className:"border rounded-lg p-4 md:col-span-2",children:e.jsx(P,{})})]})})})})]})})]})}export{Wt as default};
