import{c as j,a as d,Y as K,o as ae,j as e,Z as te,p as se,q as ne,x as q,v as z,w as _,_ as L,P as B,y as ce,z as le,D as ie,$ as de,a1 as pe,g as me,R as ue}from"./main-Dyet6hp8.js";import{C as fe,u as he,D as xe,b as be,c as je,g as ve}from"./useClientDatabaseService-BIkLGm-u.js";import{F as ge,a as v,b as g,c as D,d as F,e as A}from"./form-CBWKKe57.js";import{I as y}from"./input-DRIZwA-x.js";import{u as Pe,a as we}from"./zod-DlANlLxK.js";import{o as Ce,s as P}from"./schemas-6m5s2bNq.js";import{B as G}from"./button-BwAOa9kR.js";import{u as Ne,g as Re,a as De,b as Fe,S as ye}from"./index-DNiSzxSx.js";import{u as Se}from"./use-show-toast-50IJRKOi.js";import{u as Ee}from"./useAppSelector-DMWk-na0.js";import{G as Ae}from"./index-B7oe5FN6.js";import{h as Oe,R as Me,u as _e,F as Te,X as Ie}from"./index-CijKulxP.js";import{D as ke}from"./data-table-DijHvdqA.js";import{c as b}from"./ColumnConfig-CNgXLnA8.js";import{C as w}from"./CommonField-fwNvoV4X.js";import{D as O}from"./DepartmentFormField-CBwNxXYg.js";import{P as I}from"./ProjectFormField-tUyF5ueo.js";import{u as Ue}from"./useRequest-s0buVQB2.js";import{h as Ve}from"./serviceHandler-BlQljMi1.js";import{u as Ke}from"./useQuery-BFn0dZqN.js";import{P as qe}from"./ProjectViewModel-CzJ36bb_.js";import"./index-CTnjfjH0.js";import"./BaseEntity-DGhPHkWu.js";import"./createLucideIcon-CES2GiEw.js";import"./useAuthState-Dxm3_G9f.js";const l={databaseName:j({name:"databaseName",label:"Database Name",max:50}),databaseSchema:j({name:"databaseSchema",label:"Database Schema",max:50}),host:j({name:"host",label:"Host",max:50}),port:j({name:"port",label:"Port",max:50}),username:j({name:"username",label:"Username",max:50}),password:j({name:"password",label:"Password",max:50}),project:j({name:"project",label:"Project"}),projectName:j({name:"projectName",label:"Project"})},ze=Ce({databaseName:P().max(l.databaseName.max,{error:l.databaseName.maxError}),databaseSchema:P().max(l.databaseSchema.max,{error:l.databaseSchema.maxError}),host:P().max(l.host.max,{error:l.host.maxError}),port:P().max(l.port.max,{error:l.port.maxError}),username:P().max(l.username.max,{error:l.username.maxError}),password:P().max(l.password.max,{error:l.password.maxError}),project:P(),projectName:P()}),Le=({clientDatabaseDTO:o})=>{const[s,a]=d.useState(()=>o?new fe(o):void 0),r=Pe({resolver:we(ze),defaultValues:{databaseName:s?.databaseName??"",databaseSchema:s?.databaseSchema??"",host:s?.host??"",port:s?.port??"",username:s?.username??"",password:s?.password??"",project:s?.project??"",projectName:s?.projectName??""}});return{form:r,setFormError:(n,c)=>{const{setToastError:i}=c||{},u=n,p=u?.response?.data?.errors??{};typeof p=="string"?i?.(p):p&&Object.keys(p).length>0?Object.keys(p).forEach(f=>{const h=f.replace(/^clientDatabase\./,"");h in r.getValues()&&r.setError(h,{type:"server",message:p[f][0]??"Invalid value"})}):i?.(u?.response?.data?.message??"Server error")},clientDatabaseViewModel:s,setClientDatabaseViewModel:a}};function Be(o){return Ae({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"},child:[]}]})(o)}var k="Popover",[$,Uo]=se(k,[K]),T=K(),[Ge,C]=$(k),H=o=>{const{__scopePopover:s,children:a,open:r,defaultOpen:t,onOpenChange:n,modal:c=!1}=o,i=T(s),u=d.useRef(null),[p,f]=d.useState(!1),[h,x]=ae({prop:r,defaultProp:t??!1,onChange:n,caller:k});return e.jsx(te,{...i,children:e.jsx(Ge,{scope:s,contentId:ne(),triggerRef:u,open:h,onOpenChange:x,onOpenToggle:d.useCallback(()=>x(S=>!S),[x]),hasCustomAnchor:p,onCustomAnchorAdd:d.useCallback(()=>f(!0),[]),onCustomAnchorRemove:d.useCallback(()=>f(!1),[]),modal:c,children:a})})};H.displayName=k;var Z="PopoverAnchor",$e=d.forwardRef((o,s)=>{const{__scopePopover:a,...r}=o,t=C(Z,a),n=T(a),{onCustomAnchorAdd:c,onCustomAnchorRemove:i}=t;return d.useEffect(()=>(c(),()=>i()),[c,i]),e.jsx(L,{...n,...r,ref:s})});$e.displayName=Z;var Q="PopoverTrigger",W=d.forwardRef((o,s)=>{const{__scopePopover:a,...r}=o,t=C(Q,a),n=T(a),c=q(s,t.triggerRef),i=e.jsx(z.button,{type:"button","aria-haspopup":"dialog","aria-expanded":t.open,"aria-controls":t.contentId,"data-state":oe(t.open),...r,ref:c,onClick:_(o.onClick,t.onOpenToggle)});return t.hasCustomAnchor?i:e.jsx(L,{asChild:!0,...n,children:i})});W.displayName=Q;var V="PopoverPortal",[He,Ze]=$(V,{forceMount:void 0}),X=o=>{const{__scopePopover:s,forceMount:a,children:r,container:t}=o,n=C(V,s);return e.jsx(He,{scope:s,forceMount:a,children:e.jsx(B,{present:a||n.open,children:e.jsx(ce,{asChild:!0,container:t,children:r})})})};X.displayName=V;var M="PopoverContent",Y=d.forwardRef((o,s)=>{const a=Ze(M,o.__scopePopover),{forceMount:r=a.forceMount,...t}=o,n=C(M,o.__scopePopover);return e.jsx(B,{present:r||n.open,children:n.modal?e.jsx(We,{...t,ref:s}):e.jsx(Xe,{...t,ref:s})})});Y.displayName=M;var Qe=le("PopoverContent.RemoveScroll"),We=d.forwardRef((o,s)=>{const a=C(M,o.__scopePopover),r=d.useRef(null),t=q(s,r),n=d.useRef(!1);return d.useEffect(()=>{const c=r.current;if(c)return Oe(c)},[]),e.jsx(Me,{as:Qe,allowPinchZoom:!0,children:e.jsx(J,{...o,ref:t,trapFocus:a.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:_(o.onCloseAutoFocus,c=>{c.preventDefault(),n.current||a.triggerRef.current?.focus()}),onPointerDownOutside:_(o.onPointerDownOutside,c=>{const i=c.detail.originalEvent,u=i.button===0&&i.ctrlKey===!0,p=i.button===2||u;n.current=p},{checkForDefaultPrevented:!1}),onFocusOutside:_(o.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1})})})}),Xe=d.forwardRef((o,s)=>{const a=C(M,o.__scopePopover),r=d.useRef(!1),t=d.useRef(!1);return e.jsx(J,{...o,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:n=>{o.onCloseAutoFocus?.(n),n.defaultPrevented||(r.current||a.triggerRef.current?.focus(),n.preventDefault()),r.current=!1,t.current=!1},onInteractOutside:n=>{o.onInteractOutside?.(n),n.defaultPrevented||(r.current=!0,n.detail.originalEvent.type==="pointerdown"&&(t.current=!0));const c=n.target;a.triggerRef.current?.contains(c)&&n.preventDefault(),n.detail.originalEvent.type==="focusin"&&t.current&&n.preventDefault()}})}),J=d.forwardRef((o,s)=>{const{__scopePopover:a,trapFocus:r,onOpenAutoFocus:t,onCloseAutoFocus:n,disableOutsidePointerEvents:c,onEscapeKeyDown:i,onPointerDownOutside:u,onFocusOutside:p,onInteractOutside:f,...h}=o,x=C(M,a),S=T(a);return _e(),e.jsx(Te,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:t,onUnmountAutoFocus:n,children:e.jsx(ie,{asChild:!0,disableOutsidePointerEvents:c,onInteractOutside:f,onEscapeKeyDown:i,onPointerDownOutside:u,onFocusOutside:p,onDismiss:()=>x.onOpenChange(!1),children:e.jsx(de,{"data-state":oe(x.open),role:"dialog",id:x.contentId,...S,...h,ref:s,style:{...h.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),ee="PopoverClose",Ye=d.forwardRef((o,s)=>{const{__scopePopover:a,...r}=o,t=C(ee,a);return e.jsx(z.button,{type:"button",...r,ref:s,onClick:_(o.onClick,()=>t.onOpenChange(!1))})});Ye.displayName=ee;var Je="PopoverArrow",eo=d.forwardRef((o,s)=>{const{__scopePopover:a,...r}=o,t=T(a);return e.jsx(pe,{...t,...r,ref:s})});eo.displayName=Je;function oe(o){return o?"open":"closed"}var oo=H,ro=W,ao=X,to=Y;function so({...o}){return e.jsx(oo,{"data-slot":"popover",...o})}function no({...o}){return e.jsx(ro,{"data-slot":"popover-trigger",...o})}function co({className:o,align:s="center",sideOffset:a=4,...r}){return e.jsx(ao,{children:e.jsx(to,{"data-slot":"popover-content",align:s,sideOffset:a,className:me("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",o),...r})})}function lo({columns:o,data:s,isLoading:a,onSelect:r,label:t,value:n,onChange:c}){const[i,u]=ue.useState(!1),p=Ne({data:s,columns:o,columnResizeMode:"onChange",enableRowSelection:!0,enableColumnFilters:!0,getCoreRowModel:Fe(),getFilteredRowModel:De(),getSortedRowModel:Re()}),f=h=>{c?.(h?.original),r?.(h.original),u(!1)};return e.jsxs(so,{open:i,onOpenChange:u,children:[e.jsx(no,{asChild:!0,children:e.jsxs(G,{variant:"outline",role:"combobox",className:"w-full justify-between",children:[n||t,e.jsx(Be,{})]})}),e.jsx(co,{className:"w-[600px] p-2",children:e.jsx(ke,{variant:"dropdown",table:p,isLoading:a,onSelectRow:f})})]})}b({accessorKey:O.departmentID.name,header:O.departmentID.label}),b({accessorKey:O.departmentID.name,header:O.departmentName.label}),b({accessorKey:O.headDepartmentName.name,header:O.headDepartmentName.label}),b({accessorKey:w.createdAtFormat.name,header:w.createdAtFormat.label}),b({accessorKey:w.createdByName.name,header:w.createdByName.label}),b({accessorKey:w.updatedAtFormat.name,header:w.updatedAtFormat.label}),b({accessorKey:w.updatedAtFormat.name,header:w.updatedAtFormat.label});const io=[b({header:I.projectCode.label,accessorKey:I.projectCode.name}),b({header:I.projectName.label,accessorKey:I.projectName.name})],po=()=>{const{request:o}=Ue();async function s(a,r){const t=new FormData;return t.append("param[offset]",a.offset),t.append("param[limit]",a.limit),t.append("param[sort]",a.sort),t.append("param[order]",a.order),a.filter!=="{}"&&t.append("param[filter]",a.filter),r.forEach(n=>{t.append("table[]",n)}),o({url:"/universal/dropdown-table",method:"POST",data:t})}return{dropdownTable:s}},mo=()=>{const{dropdownTable:o}=po();async function s(a,r,t,n){return Ve(async()=>{const c=await o(a,r),i={};for(const u of r){const p=c[u],f=t[u];i[u]={...p,rows:p.rows.map(h=>new f(h))}}return i},n)}return{dropdownTable:s}};function Vo({clientDatabaseDTO:o,open:s,onOpenChange:a}){const{form:r,setFormError:t,clientDatabaseViewModel:n,setClientDatabaseViewModel:c}=Le({clientDatabaseDTO:o}),{createClientDatabase:i,updateClientDatabase:u}=he(),{dropdownTable:p}=mo(),f={offset:"0",limit:"20",sort:"createdAtFormat",order:"desc",filter:"{}"},{data:h,refetch:x}=Ke({queryKey:["/universal/dropdown-table",f],queryFn:async()=>await p(f,["project"],{project:qe}),enabled:!1});d.useEffect(()=>{x()},[x]);const S=Se(),N=Ee(m=>m.loading.global),re=async()=>{const E={...r.getValues(),...n?.UUID?{UUID:n.UUID}:{}};E?.UUID?await u(E,{onSuccess:R=>{c(R),a(!1)},onError:R=>{t(R,{setToastError(U){S("Error",U,"error")}})}}):await i(E,{onSuccess:R=>{c(R),a(!1)},onError:R=>{t(R,{setToastError(U){S("Error",U,"error")}})}})};return e.jsx(xe,{open:s,onOpenChange:a,children:e.jsx(be,{className:"sm:max-w-[720px]",showCloseButton:!1,children:e.jsx("div",{className:"w-full",children:e.jsx(ge,{...r,children:e.jsxs("form",{className:"grid grid-cols-3 gap-4",onSubmit:r.handleSubmit(re),children:[e.jsxs(je,{className:"mb-4 col-span-3 flex flex-row items-center justify-start",children:[e.jsx(ye,{}),e.jsx(ve,{asChild:!0,children:e.jsx(G,{variant:"ghost",type:"button",className:"cursor-pointer rounded-full",children:e.jsx(Ie,{className:"h-5 w-5 text-accent-foreground dark:text-accent-foreground"})})})]}),e.jsx(v,{control:r.control,name:l.databaseName.name,render:({field:m})=>e.jsxs(g,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.databaseName.label}),e.jsx(F,{children:e.jsx(y,{...m,disabled:N,required:!0})}),e.jsx(A,{})]})}),e.jsx(v,{control:r.control,name:l.databaseSchema.name,render:({field:m})=>e.jsxs(g,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.databaseSchema.label}),e.jsx(F,{children:e.jsx(y,{...m,disabled:N,required:!0})}),e.jsx(A,{})]})}),e.jsx(v,{control:r.control,name:l.host.name,render:({field:m})=>e.jsxs(g,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.host.label}),e.jsx(F,{children:e.jsx(y,{...m,disabled:N,required:!0})}),e.jsx(A,{})]})}),e.jsx(v,{control:r.control,name:l.port.name,render:({field:m})=>e.jsxs(g,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.port.label}),e.jsx(F,{children:e.jsx(y,{...m,disabled:N,required:!0})}),e.jsx(A,{})]})}),e.jsx(v,{control:r.control,name:l.username.name,render:({field:m})=>e.jsxs(g,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.username.label}),e.jsx(F,{children:e.jsx(y,{...m,disabled:N,required:!0})}),e.jsx(A,{})]})}),e.jsx(v,{control:r.control,name:l.password.name,render:({field:m})=>e.jsxs(g,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.password.label}),e.jsx(F,{children:e.jsx(y,{...m,disabled:N,required:!0})}),e.jsx(A,{})]})}),e.jsx(v,{name:l.project.name,render:({field:m})=>e.jsx(g,{className:"hidden",children:e.jsx(y,{...m})})}),e.jsx(v,{name:l.projectName.name,render:({field:m})=>e.jsxs(g,{children:[e.jsx(D,{children:l.projectName.label}),e.jsx(F,{children:e.jsx(lo,{...m,columns:io,data:h?.project?.rows??[],isLoading:N,label:l.project.label,onSelect:E=>{m.onChange(E.projectName),r.setValue("project",E.UUID)}})})]})})]})})})})})}export{Vo as default};
