import{u as v,a as E,l as F,j as r,H as k,b,t as n,d,e as D,f as x,g as O}from"./main-DY2sbF6P.js";import{A as C}from"./app-layout-DM22gHhp.js";import I from"./api-test-layout-CkJ3fyRT.js";import N from"./test-case-sidebar-Cgj19n-E.js";import P from"./test-case-form-C8oCS3gv.js";import q from"./test-case-output-DwWE1kmq.js";import{u as g}from"./useQuery-CLwaWHy_.js";import{u as H}from"./useApiTestService-fUlyPSNV.js";import{F as L}from"./index.esm-D7VeYQlz.js";import{u as _}from"./documentation-tab-CgsXqrEN.js";import{u as f}from"./useAppSelector-BiPAHM_x.js";import{s as K}from"./apiTestSelectors-BJyltacD.js";import{F as V}from"./form-sOEOGGHr.js";import{s as h}from"./clientDatabaseSelectors-BCEKIPh0.js";import{u as Q}from"./use-show-toast-CvS8mOw9.js";import{u as R}from"./useClientDatabaseService-Clt8uSB_.js";import"./button-O2UeMCYz.js";import"./index-COGUnvNa.js";import"./index-B14W8M9P.js";import"./x-BX8vMLw0.js";import"./createLucideIcon-CNr2s4p7.js";import"./chevron-right-CAudNKCH.js";import"./dropdown-menu-CJlTW-C2.js";import"./index-BCsd0Nbg.js";import"./index-BkYD1EKP.js";import"./index-BqXMCpwo.js";import"./check-MP7LZKO0.js";import"./useAuthState-Do9lM1av.js";import"./index-DxTDycXr.js";import"./tree-view-PBkHLThv.js";import"./input-DxMNrH09.js";import"./ApiTestFormField-D8capE04.js";import"./ApiTestViewModel-CvJ_mYgo.js";import"./skeleton-KmmC_05L.js";import"./tabs-D8iwZnfN.js";import"./data-tab-Cxbw4TX1.js";import"./select-CkajZc4m.js";import"./api-test-data-table-RYpDdSvO.js";import"./index-Dk5hdd9A.js";import"./table-DffdKZVv.js";import"./ColumnConfig-BzAXo2IC.js";import"./ApiTestDataFormField-B4kiEgJZ.js";import"./table-selection-popover-C9u0aWxZ.js";import"./popover-azegvj7E.js";import"./label-aBIViTaz.js";import"./ClientDatabaseTableViewModel-CWID7VbN.js";import"./loader-circle-D1iJtV4J.js";import"./scenario-tab-C1OViOrC.js";import"./useRequest-BoTLMqeD.js";import"./BaseEntity-DGhPHkWu.js";import"./serviceHandler-BlQljMi1.js";import"./ClientDatabaseViewModel-CZz8IN5P.js";import"./zod-BErPEfBI.js";import"./schemas-DUe4ZLmH.js";import"./textarea-BPnbcbrs.js";function Be(){const e=v(),{indexApiTest:j,createApiTest:y,updateApiTest:A}=H(),o=f(K),a=f(h),T=f(h),{form:i}=_({apiTestDTO:o}),p=Q(),w={offset:"0",limit:"10",sort:"table",order:"asc",filter:""},{data:u}=g({queryKey:["/backend/api_test/index"],queryFn:async()=>await j(),enabled:!0});g({queryKey:["/backend/client_database/get-table-list"],queryFn:async()=>{await S({params:w,clientDatabaseToken:T?.password??""},{callbacks:{onSuccess:s=>{const l={total:s.total,rows:s.rows.map(c=>c.dto)};e(O(l))},onError:s=>{p("Error","Failed to load client database tables","error"),console.error(s)}}})},enabled:!!T?.password});const{getTableList:S}=R();E.useEffect(()=>{u&&e(F(u))},[e,u]);const U=async()=>{console.log("Submit");try{if(o&&a&&a.password){const l=i.getValues("apiTestData").map(t=>({apiTest:o.UUID,enabled:t.enabled??0,key:t.key??"",value:t.value??"",description:t.description??"",fieldType:t.fieldType??""})),c={...i.getValues(),UUID:o.UUID,project:a.project,clientDatabase:a.UUID,apiTestHasDatas:l??[]},m=[o?.UUID].filter(t=>t!==void 0);o.isNew?(console.log("Create API Test"),await y({apiTestDTO:c,clientDatabaseToken:a.password},{onSuccess:t=>{e(d(m)),e(D(t)),e(n({action:null})),e(x(t.apiTestDTO))},onError:t=>{console.error(t),p("Error","Failed to create test case","error"),e(b()),e(n({action:null})),e(d(m))}})):(console.log("Update API Test"),await A({apiTestDTO:c,clientDatabaseToken:a.password},{onSuccess:t=>{e(d(m)),e(D(t)),e(n({action:null})),e(x(t.apiTestDTO))},onError:t=>{console.error(t),p("Error","Failed to create test case","error"),e(b()),e(n({action:null})),e(d(m))}}))}else throw new Error("Missing Client Database Token")}catch(s){console.error(s);const l=s instanceof Error?s.message:typeof s=="string"?s:"Unexpected error occurred";p("Error",l,"error")}};return r.jsxs(C,{children:[r.jsx(k,{title:"API Test"}),r.jsx(I,{children:r.jsxs(L,{...i,children:[r.jsx("div",{className:"w-60 border-none flex-shrink-0 mx-2",children:r.jsx(N,{})}),r.jsx("div",{className:"flex-1 flex flex-coloverflow-auto w-full",children:r.jsx("div",{className:"flex flex-1 space-x-2",children:r.jsx(V,{...i,children:r.jsxs("form",{onSubmit:i.handleSubmit(U),className:"grid grid-cols-1 md:grid-cols-5 gap-2 w-full",children:[r.jsx("div",{className:"border rounded-lg p-4 md:col-span-3",children:r.jsx(P,{})}),r.jsx("div",{className:"border rounded-lg p-4 md:col-span-2",children:r.jsx(q,{})})]})})})})]})})]})}export{Be as default};
