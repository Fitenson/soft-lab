import{a as d,j as e,D as Q,P as W,M as P,Y as Z,K as $,L as I,ae as ee,w as te,g as ae}from"./main-B9kSPlih.js";import{u as se,f as re,b as ne}from"./index-Dg63kHC2.js";import{T as oe,a as le,b as S,c as ie,d as ce,e as z}from"./table-DAEYykBQ.js";import{c as w}from"./ColumnConfig-DLwQQGE7.js";import{A as C}from"./ApiTestDataFormField-B9GM47K2.js";import{u as de,S as ue,a as pe,c as be,d as N}from"./select-NvYdOhSS.js";import{C as fe}from"./check-CfYvyZhz.js";import{S as he}from"./skeleton-Bp8yWBgb.js";import{u as L}from"./useAppSelector-5m2jQQPi.js";import{I as me}from"./input-DtVRmdZn.js";import{F as xe,a as D,b as E,d as F}from"./form-D7n3H12L.js";import{d as ge}from"./index.esm-DTnlfpzt.js";import ke from"./table-selection-popover-Bat9jU4s.js";import{u as Ce}from"./useClientDatabaseService-B3NIh_j4.js";import{s as ve}from"./clientDatabaseSelectors-Cw1rL9yb.js";import"./button-IWkCiMuA.js";import"./createLucideIcon-CDI3oWZc.js";import"./index-B39AUxGu.js";import"./index-Cr9z3bEa.js";import"./label-BJYzQMLw.js";import"./popover-BLC5I0-l.js";import"./index-Bdx8hlOp.js";import"./loader-circle-r4T2xauo.js";import"./serviceHandler-BlQljMi1.js";import"./useRequest-w8ljcJHi.js";import"./useAuthState-Di_HTcE-.js";import"./BaseEntity-DGhPHkWu.js";import"./ClientDatabaseViewModel-CZz8IN5P.js";var R="Checkbox",[ye,rt]=Q(R),[je,_]=ye(R);function Te(t){const{__scopeCheckbox:s,checked:p,children:f,defaultChecked:u,disabled:r,form:h,name:c,onCheckedChange:i,required:m,value:v="on",internal_do_not_use_render:b}=t,[x,T]=Z({prop:p,defaultProp:u??!1,onChange:i,caller:R}),[y,n]=d.useState(null),[a,o]=d.useState(null),l=d.useRef(!1),g=y?!!h||!!y.closest("form"):!0,k={checked:x,disabled:r,setChecked:T,control:y,setControl:n,name:c,form:h,value:v,hasConsumerStoppedPropagationRef:l,required:m,defaultChecked:j(u)?!1:u,isFormControl:g,bubbleInput:a,setBubbleInput:o};return e.jsx(je,{scope:s,...k,children:Se(b)?b(k):f})}var B="CheckboxTrigger",M=d.forwardRef(({__scopeCheckbox:t,onKeyDown:s,onClick:p,...f},u)=>{const{control:r,value:h,disabled:c,checked:i,required:m,setControl:v,setChecked:b,hasConsumerStoppedPropagationRef:x,isFormControl:T,bubbleInput:y}=_(B,t),n=$(u,v),a=d.useRef(i);return d.useEffect(()=>{const o=r?.form;if(o){const l=()=>b(a.current);return o.addEventListener("reset",l),()=>o.removeEventListener("reset",l)}},[r,b]),e.jsx(P.button,{type:"button",role:"checkbox","aria-checked":j(i)?"mixed":i,"aria-required":m,"data-state":U(i),"data-disabled":c?"":void 0,disabled:c,value:h,...f,ref:n,onKeyDown:I(s,o=>{o.key==="Enter"&&o.preventDefault()}),onClick:I(p,o=>{b(l=>j(l)?!0:!l),y&&T&&(x.current=o.isPropagationStopped(),x.current||o.stopPropagation())})})});M.displayName=B;var K=d.forwardRef((t,s)=>{const{__scopeCheckbox:p,name:f,checked:u,defaultChecked:r,required:h,disabled:c,value:i,onCheckedChange:m,form:v,...b}=t;return e.jsx(Te,{__scopeCheckbox:p,checked:u,defaultChecked:r,disabled:c,required:h,onCheckedChange:m,name:f,form:v,value:i,internal_do_not_use_render:({isFormControl:x})=>e.jsxs(e.Fragment,{children:[e.jsx(M,{...b,ref:s,__scopeCheckbox:p}),x&&e.jsx(V,{__scopeCheckbox:p})]})})});K.displayName=R;var H="CheckboxIndicator",q=d.forwardRef((t,s)=>{const{__scopeCheckbox:p,forceMount:f,...u}=t,r=_(H,p);return e.jsx(W,{present:f||j(r.checked)||r.checked===!0,children:e.jsx(P.span,{"data-state":U(r.checked),"data-disabled":r.disabled?"":void 0,...u,ref:s,style:{pointerEvents:"none",...t.style}})})});q.displayName=H;var J="CheckboxBubbleInput",V=d.forwardRef(({__scopeCheckbox:t,...s},p)=>{const{control:f,hasConsumerStoppedPropagationRef:u,checked:r,defaultChecked:h,required:c,disabled:i,name:m,value:v,form:b,bubbleInput:x,setBubbleInput:T}=_(J,t),y=$(p,T),n=de(r),a=ee(f);d.useEffect(()=>{const l=x;if(!l)return;const g=window.HTMLInputElement.prototype,A=Object.getOwnPropertyDescriptor(g,"checked").set,X=!u.current;if(n!==r&&A){const Y=new Event("click",{bubbles:X});l.indeterminate=j(r),A.call(l,j(r)?!1:r),l.dispatchEvent(Y)}},[x,n,r,u]);const o=d.useRef(j(r)?!1:r);return e.jsx(P.input,{type:"checkbox","aria-hidden":!0,defaultChecked:h??o.current,required:c,disabled:i,name:m,value:v,form:b,...s,tabIndex:-1,ref:y,style:{...s.style,...a,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});V.displayName=J;function Se(t){return typeof t=="function"}function j(t){return t==="indeterminate"}function U(t){return j(t)?"indeterminate":t?"checked":"unchecked"}function G({className:t,...s}){return e.jsx(K,{"data-slot":"checkbox",className:te("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...s,children:e.jsx(q,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(fe,{className:"size-3.5"})})})}function we(t,s){return({getValue:p,row:f})=>{const u=!!p(),r=f.original,h=s?.disabled?.(r)??!1,c=s?.ariaLabel?.(r)??"Toggle";return e.jsx("div",{className:"flex items-center",onClick:i=>i.stopPropagation(),children:e.jsx(G,{checked:u,disabled:h,"aria-label":c,onCheckedChange:i=>t({row:r,next:!!i}),className:"translate-y-[1px]"})})}}const Re=[w({accessorKey:C.enabled.name,header:null,size:44,minSize:36,maxSize:64,enableSorting:!1,cell:we(({row:t,next:s})=>{console.log(t),console.log(s)},{})}),w({accessorKey:C.key.name,header:C.key.label,enableSorting:!1}),w({accessorKey:C.value.name,header:C.value.label,enableSorting:!1}),w({accessorKey:C.description.name,header:C.description.label,enableSorting:!1})];class O{field={};table=new Set;type=null;setField(s){switch(this.type=s,s){case"text":this.field={text:"string"};break;case"file":this.field={file:"base64"};break;case"dropdown":this.field={};break;default:throw new Error("Unknown field type "+s)}}setDropdown(s){if(this.type!=="dropdown")throw new Error("setDropdown() can only be used after setField('dropdown')");if(this.table.has(s))throw new Error(`Duplicate table name: ${s}`);this.table.add(s),this.field={dropdown:{table:s}}}asJSONString(){return JSON.stringify(this.field,null,2)}asJson(){return this.field}getField(){return this.field}}const Ne=["key","value","description"],De=t=>Ne.includes(t);function nt({form:t}){const[s,p]=d.useState(),{getTableList:f}=Ce(),u=L(ve);d.useEffect(()=>{(async()=>{await f({params:{offset:"0",limit:"10",sort:"table",order:"asc",filter:""},clientDatabaseToken:u?.password??""},{callbacks:{onSuccess:o=>{p(o.rows)}}})})()},[]);const[r,h]=d.useState(!1),{fields:c,append:i}=ge({control:t.control,name:"apiTestData"}),m=se({data:t.getValues("apiTestData")??[],columns:Re,enableRowSelection:!0,enableSorting:!1,enableFilters:!1,enableSortingRemoval:!1,getCoreRowModel:ne()}),v=L(ae),b=d.useRef(null),x=n=>{if(typeof n=="number"){if(b.current===n)return;b.current=n}const a=new O;a.setField("text"),i({enabled:0,key:"",value:"",description:"",fieldType:a.asJSONString()},{shouldFocus:!1})},T=(n,a)=>{t.setValue(`apiTestData.${n}.enabled`,a),n===c.length-1&&a===1&&x(n)},y=n=>{t.getValues(`apiTestData.${n}.enabled`)!==1&&t.setValue(`apiTestData.${n}.enabled`,1),n===c.length-1&&x(n)};return d.useEffect(()=>{c.length===0&&(i({enabled:0,key:"",value:"",description:""},{shouldFocus:!1}),b.current=null)},[c.length,i]),e.jsx(xe,{...t,children:e.jsxs(oe,{className:"card",children:[e.jsx(le,{children:m.getHeaderGroups().map(n=>e.jsx(S,{className:"border-b border-accent dark:border-accent",children:n.headers.map(a=>e.jsxs(ie,{className:"m-0 p-0 border-r border-accent dark:border-accent last:border-r-0",style:{width:a.getSize()},children:[a.isPlaceholder?null:re(a.column.columnDef.header,a.getContext()),a.column.getCanResize()&&e.jsx("div",{onMouseDown:a.getResizeHandler(),onTouchStart:a.getResizeHandler(),className:`absolute right-0 top-0 h-full w-1 cursor-col-resize select-none
                                            ${a.column.getIsResizing()?"bg-blue-500":"bg-transparent hover:bg-gray-400"}`})]},a.id))},n.id))}),e.jsx(ce,{children:v?Array.from({length:5}).map((n,a)=>e.jsx(S,{children:m.getAllLeafColumns().map(o=>e.jsx("td",{className:"px-2 py-2",children:e.jsx(he,{className:"h-4 w-full rounded-2xl p-4 m-1 gap-2"})},o.id))},`skeleton-${a}`)):c.length>0?c.map((n,a)=>e.jsx(S,{className:"cursor-pointer p-2 border border-accent dark:border-accent text-foreground dark:text-foreground",children:m.getAllLeafColumns().map(o=>e.jsx(z,{className:"p-2",children:o.id===C.enabled.name?e.jsx(D,{control:t.control,name:`apiTestData.${a}.enabled`,render:({field:l})=>e.jsx(E,{children:e.jsx(F,{children:e.jsx("div",{onClick:g=>g.stopPropagation(),className:"flex items-center",children:e.jsx(G,{checked:l.value===1,onCheckedChange:g=>{const k=g?1:0;l.onChange(k),T(a,k)},"aria-label":"Toggle",className:"cursor-pointer h-6 w-6 shrink-0 translate-y-[1px]"})})})})}):De(o.id)&&e.jsxs("div",{className:"flex flex-row gap-1",children:[e.jsx(D,{control:t.control,name:`apiTestData.${a}.${o.id}`,render:({field:l})=>e.jsx(E,{children:e.jsx(F,{children:e.jsx(me,{...l,value:l.value??"",onChange:g=>l.onChange(g.target.value),onFocus:()=>y(a),className:"w-full h-8"})})})}),e.jsx(D,{name:`apiTestData.${a}.${C.fieldType.name}`,control:t.control,render:({field:l})=>e.jsx(E,{children:e.jsx(F,{children:o.id===C.value.name&&e.jsxs(d.Fragment,{children:[e.jsxs(ue,{onValueChange:g=>{const k=new O;k.setField(g),g==="dropdown"&&(setTimeout(()=>h(!0),500),k.setDropdown("user")),l.onChange(k.asJSONString())},children:[e.jsx(pe,{className:"h-6 w-6 flex items-center justify-center rounded-md border text-xs p-1"}),e.jsxs(be,{children:[e.jsx(N,{value:"text",children:"Text"}),e.jsx(N,{value:"dropdown",children:"Dropdown"}),e.jsx(N,{value:"file",children:"File"})]})]}),e.jsx(ke,{data:s??[],isOpen:r,setIsOpen:h})]})})})})]})},o.id))},n.id)):e.jsx(S,{children:e.jsx(z,{colSpan:m.getAllLeafColumns().length,className:"h-24 text-center text-muted-foreground",children:"No test data rows found."})})})]})})}export{nt as default};
