import{c as C,a as d,Y as k,v as Q,j as e,Z as ee,w as oe,x as re,A as K,y as V,z as A,_ as U,P as B,B as ae,C as te,D as se,$ as ne,a1 as ce,g as le,R as ie}from"./main-Cw8DmI14.js";import{C as de,u as me,D as pe,b as ue,c as fe,g as xe}from"./useClientDatabaseService-Cd6g2EsL.js";import{F as he,a as P,b as w,c as R,d as D,e as N}from"./form-BIWuqEpj.js";import{I as F}from"./input-DHJt8_gl.js";import{u as be,a as ve}from"./zod-C0qFcJEL.js";import{o as ge,s as S}from"./schemas-6m5s2bNq.js";import{B as q}from"./button-DK9pvgoa.js";import{u as je,g as Ce,a as Pe,b as we,S as Re}from"./index-CPUETk_f.js";import{u as De}from"./use-show-toast-Adc82vhT.js";import{u as Fe}from"./useAppSelector-B4X_ZpnI.js";import{D as Ne}from"./data-table-C5PVAbBy.js";import{h as Se,R as Ee,u as ye,F as Ae,X as Oe}from"./index-DkmNQ6_p.js";import{c as h}from"./ColumnConfig-DUROJKcU.js";import{C as b}from"./CommonField-fwNvoV4X.js";import{D as E}from"./DepartmentFormField-qujWYDWS.js";import{P as _}from"./ProjectFormField-Byb24P-n.js";import"./index-BuN_71xw.js";import"./serviceHandler-BlQljMi1.js";import"./useRequest-yWknGXUl.js";import"./useAuthState-kObe2O0J.js";import"./BaseEntity-DGhPHkWu.js";import"./index-CkkLoj5d.js";import"./createLucideIcon-WTq1-3h1.js";const l={databaseName:C({name:"databaseName",label:"Database Name",max:50}),databaseSchema:C({name:"databaseSchema",label:"Database Schema",max:50}),host:C({name:"host",label:"Host",max:50}),port:C({name:"port",label:"Port",max:50}),username:C({name:"username",label:"Username",max:50}),password:C({name:"password",label:"Password",max:50}),project:C({name:"project",label:"Project"})},_e=ge({databaseName:S().max(l.databaseName.max,{error:l.databaseName.maxError}),databaseSchema:S().max(l.databaseSchema.max,{error:l.databaseSchema.maxError}),host:S().max(l.host.max,{error:l.host.maxError}),port:S().max(l.port.max,{error:l.port.maxError}),username:S().max(l.username.max,{error:l.username.maxError}),password:S().max(l.password.max,{error:l.password.maxError})}),Me=({clientDatabaseDTO:o})=>{const[a,t]=d.useState(()=>o?new de(o):void 0),r=be({resolver:ve(_e),defaultValues:{databaseName:a?.databaseName??"",databaseSchema:a?.databaseSchema??"",host:a?.host??"",port:a?.port??"",username:a?.username??"",password:a?.password??""}});return{form:r,setFormError:(s,c)=>{const{setToastError:m}=c||{},f=s,p=f?.response?.data?.errors??{};typeof p=="string"?m?.(p):p&&Object.keys(p).length>0?Object.keys(p).forEach(u=>{const x=u.replace(/^clientDatabase\./,"");x in r.getValues()&&r.setError(x,{type:"server",message:p[u][0]??"Invalid value"})}):m?.(f?.response?.data?.message??"Server error")},clientDatabaseViewModel:a,setClientDatabaseViewModel:t}};var M="Popover",[z,Ro]=oe(M,[k]),O=k(),[Ie,v]=z(M),L=o=>{const{__scopePopover:a,children:t,open:r,defaultOpen:n,onOpenChange:s,modal:c=!1}=o,m=O(a),f=d.useRef(null),[p,u]=d.useState(!1),[x,i]=Q({prop:r,defaultProp:n??!1,onChange:s,caller:M});return e.jsx(ee,{...m,children:e.jsx(Ie,{scope:a,contentId:re(),triggerRef:f,open:x,onOpenChange:i,onOpenToggle:d.useCallback(()=>i(g=>!g),[i]),hasCustomAnchor:p,onCustomAnchorAdd:d.useCallback(()=>u(!0),[]),onCustomAnchorRemove:d.useCallback(()=>u(!1),[]),modal:c,children:t})})};L.displayName=M;var $="PopoverAnchor",Te=d.forwardRef((o,a)=>{const{__scopePopover:t,...r}=o,n=v($,t),s=O(t),{onCustomAnchorAdd:c,onCustomAnchorRemove:m}=n;return d.useEffect(()=>(c(),()=>m()),[c,m]),e.jsx(U,{...s,...r,ref:a})});Te.displayName=$;var H="PopoverTrigger",G=d.forwardRef((o,a)=>{const{__scopePopover:t,...r}=o,n=v(H,t),s=O(t),c=K(a,n.triggerRef),m=e.jsx(V.button,{type:"button","aria-haspopup":"dialog","aria-expanded":n.open,"aria-controls":n.contentId,"data-state":J(n.open),...r,ref:c,onClick:A(o.onClick,n.onOpenToggle)});return n.hasCustomAnchor?m:e.jsx(U,{asChild:!0,...s,children:m})});G.displayName=H;var T="PopoverPortal",[ke,Ke]=z(T,{forceMount:void 0}),Z=o=>{const{__scopePopover:a,forceMount:t,children:r,container:n}=o,s=v(T,a);return e.jsx(ke,{scope:a,forceMount:t,children:e.jsx(B,{present:t||s.open,children:e.jsx(ae,{asChild:!0,container:n,children:r})})})};Z.displayName=T;var y="PopoverContent",W=d.forwardRef((o,a)=>{const t=Ke(y,o.__scopePopover),{forceMount:r=t.forceMount,...n}=o,s=v(y,o.__scopePopover);return e.jsx(B,{present:r||s.open,children:s.modal?e.jsx(Ue,{...n,ref:a}):e.jsx(Be,{...n,ref:a})})});W.displayName=y;var Ve=te("PopoverContent.RemoveScroll"),Ue=d.forwardRef((o,a)=>{const t=v(y,o.__scopePopover),r=d.useRef(null),n=K(a,r),s=d.useRef(!1);return d.useEffect(()=>{const c=r.current;if(c)return Se(c)},[]),e.jsx(Ee,{as:Ve,allowPinchZoom:!0,children:e.jsx(X,{...o,ref:n,trapFocus:t.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:A(o.onCloseAutoFocus,c=>{c.preventDefault(),s.current||t.triggerRef.current?.focus()}),onPointerDownOutside:A(o.onPointerDownOutside,c=>{const m=c.detail.originalEvent,f=m.button===0&&m.ctrlKey===!0,p=m.button===2||f;s.current=p},{checkForDefaultPrevented:!1}),onFocusOutside:A(o.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1})})})}),Be=d.forwardRef((o,a)=>{const t=v(y,o.__scopePopover),r=d.useRef(!1),n=d.useRef(!1);return e.jsx(X,{...o,ref:a,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{o.onCloseAutoFocus?.(s),s.defaultPrevented||(r.current||t.triggerRef.current?.focus(),s.preventDefault()),r.current=!1,n.current=!1},onInteractOutside:s=>{o.onInteractOutside?.(s),s.defaultPrevented||(r.current=!0,s.detail.originalEvent.type==="pointerdown"&&(n.current=!0));const c=s.target;t.triggerRef.current?.contains(c)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&n.current&&s.preventDefault()}})}),X=d.forwardRef((o,a)=>{const{__scopePopover:t,trapFocus:r,onOpenAutoFocus:n,onCloseAutoFocus:s,disableOutsidePointerEvents:c,onEscapeKeyDown:m,onPointerDownOutside:f,onFocusOutside:p,onInteractOutside:u,...x}=o,i=v(y,t),g=O(t);return ye(),e.jsx(Ae,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:n,onUnmountAutoFocus:s,children:e.jsx(se,{asChild:!0,disableOutsidePointerEvents:c,onInteractOutside:u,onEscapeKeyDown:m,onPointerDownOutside:f,onFocusOutside:p,onDismiss:()=>i.onOpenChange(!1),children:e.jsx(ne,{"data-state":J(i.open),role:"dialog",id:i.contentId,...g,...x,ref:a,style:{...x.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),Y="PopoverClose",qe=d.forwardRef((o,a)=>{const{__scopePopover:t,...r}=o,n=v(Y,t);return e.jsx(V.button,{type:"button",...r,ref:a,onClick:A(o.onClick,()=>n.onOpenChange(!1))})});qe.displayName=Y;var ze="PopoverArrow",Le=d.forwardRef((o,a)=>{const{__scopePopover:t,...r}=o,n=O(t);return e.jsx(ce,{...n,...r,ref:a})});Le.displayName=ze;function J(o){return o?"open":"closed"}var $e=L,He=G,Ge=Z,Ze=W;function We({...o}){return e.jsx($e,{"data-slot":"popover",...o})}function Xe({...o}){return e.jsx(He,{"data-slot":"popover-trigger",...o})}function Ye({className:o,align:a="center",sideOffset:t=4,...r}){return e.jsx(Ge,{children:e.jsx(Ze,{"data-slot":"popover-content",align:a,sideOffset:t,className:le("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",o),...r})})}function Je({columns:o,data:a,isLoading:t,onSelect:r}){const[n,s]=ie.useState(!1),c=je({data:a,columns:o,columnResizeMode:"onChange",enableRowSelection:!0,enableColumnFilters:!0,getCoreRowModel:we(),getFilteredRowModel:Pe(),getSortedRowModel:Ce()});return e.jsxs(We,{open:n,onOpenChange:s,children:[e.jsx(Xe,{asChild:!0,children:e.jsx(q,{variant:"outline",role:"combobox",className:"w-full justify-between",children:"Dropdown"})}),e.jsx(Ye,{className:"w-[600px] p-2",children:e.jsx(Ne,{table:c,isLoading:t,onSelectRow:r})})]})}h({accessorKey:E.departmentID.name,header:E.departmentID.label}),h({accessorKey:E.departmentID.name,header:E.departmentName.label}),h({accessorKey:E.headDepartmentName.name,header:E.headDepartmentName.label}),h({accessorKey:b.createdAtFormat.name,header:b.createdAtFormat.label}),h({accessorKey:b.createdByName.name,header:b.createdByName.label}),h({accessorKey:b.updatedAtFormat.name,header:b.updatedAtFormat.label}),h({accessorKey:b.updatedAtFormat.name,header:b.updatedAtFormat.label});const Qe=[h({header:_.projectCode.label,accessorKey:_.projectCode.name}),h({header:_.projectName.label,accessorKey:_.projectName.name})];function Do({clientDatabaseDTO:o,open:a,onOpenChange:t}){const{form:r,setFormError:n,clientDatabaseViewModel:s,setClientDatabaseViewModel:c}=Me({clientDatabaseDTO:o}),{createClientDatabase:m,updateClientDatabase:f}=me(),p=De(),u=Fe(i=>i.loading.global),x=async()=>{const g={...r.getValues(),...s?.UUID?{UUID:s.UUID}:{}};g?.UUID?await f(g,{onSuccess:j=>{c(j),t(!1)},onError:j=>{n(j,{setToastError(I){p("Error",I,"error")}})}}):await m(g,{onSuccess:j=>{c(j),t(!1)},onError:j=>{n(j,{setToastError(I){p("Error",I,"error")}})}})};return e.jsx(pe,{open:a,onOpenChange:t,children:e.jsx(ue,{className:"sm:max-w-[720px]",showCloseButton:!1,children:e.jsx("div",{className:"w-full",children:e.jsx(he,{...r,children:e.jsxs("form",{className:"grid grid-cols-3 gap-4",onSubmit:r.handleSubmit(x),children:[e.jsxs(fe,{className:"mb-4 col-span-3 flex flex-row items-center justify-start",children:[e.jsx(Re,{}),e.jsx(xe,{asChild:!0,children:e.jsx(q,{variant:"ghost",type:"button",className:"cursor-pointer rounded-full",children:e.jsx(Oe,{className:"h-5 w-5 text-accent-foreground dark:text-accent-foreground"})})})]}),e.jsx(P,{control:r.control,name:l.databaseName.name,render:({field:i})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(R,{children:l.databaseName.label}),e.jsx(D,{children:e.jsx(F,{...i,disabled:u,required:!0})}),e.jsx(N,{})]})}),e.jsx(P,{control:r.control,name:l.databaseSchema.name,render:({field:i})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(R,{children:l.databaseSchema.label}),e.jsx(D,{children:e.jsx(F,{...i,disabled:u,required:!0})}),e.jsx(N,{})]})}),e.jsx(P,{control:r.control,name:l.host.name,render:({field:i})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(R,{children:l.host.label}),e.jsx(D,{children:e.jsx(F,{...i,disabled:u,required:!0})}),e.jsx(N,{})]})}),e.jsx(P,{control:r.control,name:l.port.name,render:({field:i})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(R,{children:l.port.label}),e.jsx(D,{children:e.jsx(F,{...i,disabled:u,required:!0})}),e.jsx(N,{})]})}),e.jsx(P,{control:r.control,name:l.username.name,render:({field:i})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(R,{children:l.username.label}),e.jsx(D,{children:e.jsx(F,{...i,disabled:u,required:!0})}),e.jsx(N,{})]})}),e.jsx(P,{control:r.control,name:l.password.name,render:({field:i})=>e.jsxs(w,{className:"my-1 ml-1 mb-1",children:[e.jsx(R,{children:l.password.label}),e.jsx(D,{children:e.jsx(F,{...i,disabled:u,required:!0})}),e.jsx(N,{})]})}),e.jsx(P,{name:l.project.name,render:({field:i})=>e.jsxs(w,{children:[e.jsx(R,{children:l.project.label}),e.jsx(Je,{columns:Qe,data:[],isLoading:u,onSelect:()=>{}}),e.jsx(D,{children:e.jsx(F,{...i})})]})})]})})})})})}export{Do as default};
