import{c as v,b as d,_ as q,p as te,j as e,$ as se,q as ne,v as ce,y as z,w as L,x as _,a0 as B,P as G,z as le,A as ie,D as de,a2 as pe,a3 as me,h as ue,R as fe,u as he,ai as xe}from"./main-DKkfExXF.js";import{D as be,b as je,c as ve,g as ge}from"./dialog-DMUUp2KZ.js";import{F as Pe,a as g,b as P,c as D,d as F,e as y}from"./form-pxTw1GV0.js";import{I as S}from"./input-B09zvZQ7.js";import{u as Ce,a as we}from"./zod-DwvpLQ2A.js";import{C as Ne,u as Re}from"./useClientDatabaseService-D53QjJ0d.js";import{o as De,s as C}from"./schemas-CeLLD0oL.js";import{B as $}from"./button-BTmt6wGY.js";import{u as Fe,g as ye,a as Se,b as Ee,S as Ae}from"./index-B-pI8hmE.js";import{u as Oe}from"./use-show-toast-B3i0I1jI.js";import{u as Me}from"./useAppSelector-BB6KD_6y.js";import{G as _e}from"./index-CFhx9SSW.js";import{h as Te,R as Ie,u as ke,F as Ue}from"./index-UMazkzlv.js";import{D as Ve}from"./data-table-BXJTpdn6.js";import{c as b}from"./ColumnConfig-VuCf9tCh.js";import{C as w}from"./CommonField-fwNvoV4X.js";import{D as O}from"./DepartmentFormField-CucI_bq4.js";import{P as I}from"./ProjectFormField-DyBysKPF.js";import{u as Ke}from"./useRequest-B0SUaPpD.js";import{h as qe}from"./serviceHandler-BlQljMi1.js";import{u as ze}from"./useQuery-CVd_1AaF.js";import{P as Le}from"./ProjectViewModel-CzJ36bb_.js";import{X as Be}from"./x-B3HB8OQ5.js";import"./index-C2B2wWGv.js";import"./BaseEntity-DGhPHkWu.js";import"./createLucideIcon-DLdpCBe9.js";import"./useAuthState-DbL-t91S.js";const l={databaseName:v({name:"databaseName",label:"Database Name",max:50}),databaseSchema:v({name:"databaseSchema",label:"Database Schema",max:50}),host:v({name:"host",label:"Host",max:50}),port:v({name:"port",label:"Port",max:50}),username:v({name:"username",label:"Username",max:50}),password:v({name:"password",label:"Password",max:50}),project:v({name:"project",label:"Project"}),projectName:v({name:"projectName",label:"Project"})},Ge=De({databaseName:C().max(l.databaseName.max,{error:l.databaseName.maxError}),databaseSchema:C().max(l.databaseSchema.max,{error:l.databaseSchema.maxError}),host:C().max(l.host.max,{error:l.host.maxError}),port:C().max(l.port.max,{error:l.port.maxError}),username:C().max(l.username.max,{error:l.username.maxError}),password:C().max(l.password.max,{error:l.password.maxError}),project:C(),projectName:C()}),$e=({clientDatabaseDTO:o})=>{const[t,a]=d.useState(()=>o?new Ne(o):void 0),n=Ce({resolver:we(Ge),defaultValues:{databaseName:t?.databaseName??"",databaseSchema:t?.databaseSchema??"",host:t?.host??"",port:t?.port??"",username:t?.username??"",password:t?.password??"",project:t?.project??"",projectName:t?.projectName??""}});return{form:n,setFormError:(s,c)=>{const{setToastError:i}=c||{},u=s,p=u?.response?.data?.errors??{};typeof p=="string"?i?.(p):p&&Object.keys(p).length>0?Object.keys(p).forEach(h=>{const f=h.replace(/^clientDatabase\./,"");f in n.getValues()&&n.setError(f,{type:"server",message:p[h][0]??"Invalid value"})}):i?.(u?.response?.data?.message??"Server error")},clientDatabaseViewModel:t,setClientDatabaseViewModel:a}};function He(o){return _e({attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M416 208c0 45.9-14.9 88.3-40 122.7L502.6 457.4c12.5 12.5 12.5 32.8 0 45.3s-32.8 12.5-45.3 0L330.7 376c-34.4 25.2-76.8 40-122.7 40C93.1 416 0 322.9 0 208S93.1 0 208 0S416 93.1 416 208zM208 352a144 144 0 1 0 0-288 144 144 0 1 0 0 288z"},child:[]}]})(o)}var k="Popover",[H,Lo]=ne(k,[q]),T=q(),[Qe,N]=H(k),Q=o=>{const{__scopePopover:t,children:a,open:n,defaultOpen:r,onOpenChange:s,modal:c=!1}=o,i=T(t),u=d.useRef(null),[p,h]=d.useState(!1),[f,x]=te({prop:n,defaultProp:r??!1,onChange:s,caller:k});return e.jsx(se,{...i,children:e.jsx(Qe,{scope:t,contentId:ce(),triggerRef:u,open:f,onOpenChange:x,onOpenToggle:d.useCallback(()=>x(E=>!E),[x]),hasCustomAnchor:p,onCustomAnchorAdd:d.useCallback(()=>h(!0),[]),onCustomAnchorRemove:d.useCallback(()=>h(!1),[]),modal:c,children:a})})};Q.displayName=k;var W="PopoverAnchor",We=d.forwardRef((o,t)=>{const{__scopePopover:a,...n}=o,r=N(W,a),s=T(a),{onCustomAnchorAdd:c,onCustomAnchorRemove:i}=r;return d.useEffect(()=>(c(),()=>i()),[c,i]),e.jsx(B,{...s,...n,ref:t})});We.displayName=W;var X="PopoverTrigger",Z=d.forwardRef((o,t)=>{const{__scopePopover:a,...n}=o,r=N(X,a),s=T(a),c=z(t,r.triggerRef),i=e.jsx(L.button,{type:"button","aria-haspopup":"dialog","aria-expanded":r.open,"aria-controls":r.contentId,"data-state":re(r.open),...n,ref:c,onClick:_(o.onClick,r.onOpenToggle)});return r.hasCustomAnchor?i:e.jsx(B,{asChild:!0,...s,children:i})});Z.displayName=X;var V="PopoverPortal",[Xe,Ze]=H(V,{forceMount:void 0}),J=o=>{const{__scopePopover:t,forceMount:a,children:n,container:r}=o,s=N(V,t);return e.jsx(Xe,{scope:t,forceMount:a,children:e.jsx(G,{present:a||s.open,children:e.jsx(le,{asChild:!0,container:r,children:n})})})};J.displayName=V;var M="PopoverContent",Y=d.forwardRef((o,t)=>{const a=Ze(M,o.__scopePopover),{forceMount:n=a.forceMount,...r}=o,s=N(M,o.__scopePopover);return e.jsx(G,{present:n||s.open,children:s.modal?e.jsx(Ye,{...r,ref:t}):e.jsx(eo,{...r,ref:t})})});Y.displayName=M;var Je=ie("PopoverContent.RemoveScroll"),Ye=d.forwardRef((o,t)=>{const a=N(M,o.__scopePopover),n=d.useRef(null),r=z(t,n),s=d.useRef(!1);return d.useEffect(()=>{const c=n.current;if(c)return Te(c)},[]),e.jsx(Ie,{as:Je,allowPinchZoom:!0,children:e.jsx(ee,{...o,ref:r,trapFocus:a.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:_(o.onCloseAutoFocus,c=>{c.preventDefault(),s.current||a.triggerRef.current?.focus()}),onPointerDownOutside:_(o.onPointerDownOutside,c=>{const i=c.detail.originalEvent,u=i.button===0&&i.ctrlKey===!0,p=i.button===2||u;s.current=p},{checkForDefaultPrevented:!1}),onFocusOutside:_(o.onFocusOutside,c=>c.preventDefault(),{checkForDefaultPrevented:!1})})})}),eo=d.forwardRef((o,t)=>{const a=N(M,o.__scopePopover),n=d.useRef(!1),r=d.useRef(!1);return e.jsx(ee,{...o,ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:s=>{o.onCloseAutoFocus?.(s),s.defaultPrevented||(n.current||a.triggerRef.current?.focus(),s.preventDefault()),n.current=!1,r.current=!1},onInteractOutside:s=>{o.onInteractOutside?.(s),s.defaultPrevented||(n.current=!0,s.detail.originalEvent.type==="pointerdown"&&(r.current=!0));const c=s.target;a.triggerRef.current?.contains(c)&&s.preventDefault(),s.detail.originalEvent.type==="focusin"&&r.current&&s.preventDefault()}})}),ee=d.forwardRef((o,t)=>{const{__scopePopover:a,trapFocus:n,onOpenAutoFocus:r,onCloseAutoFocus:s,disableOutsidePointerEvents:c,onEscapeKeyDown:i,onPointerDownOutside:u,onFocusOutside:p,onInteractOutside:h,...f}=o,x=N(M,a),E=T(a);return ke(),e.jsx(Ue,{asChild:!0,loop:!0,trapped:n,onMountAutoFocus:r,onUnmountAutoFocus:s,children:e.jsx(de,{asChild:!0,disableOutsidePointerEvents:c,onInteractOutside:h,onEscapeKeyDown:i,onPointerDownOutside:u,onFocusOutside:p,onDismiss:()=>x.onOpenChange(!1),children:e.jsx(pe,{"data-state":re(x.open),role:"dialog",id:x.contentId,...E,...f,ref:t,style:{...f.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}})})})}),oe="PopoverClose",oo=d.forwardRef((o,t)=>{const{__scopePopover:a,...n}=o,r=N(oe,a);return e.jsx(L.button,{type:"button",...n,ref:t,onClick:_(o.onClick,()=>r.onOpenChange(!1))})});oo.displayName=oe;var ro="PopoverArrow",ao=d.forwardRef((o,t)=>{const{__scopePopover:a,...n}=o,r=T(a);return e.jsx(me,{...r,...n,ref:t})});ao.displayName=ro;function re(o){return o?"open":"closed"}var to=Q,so=Z,no=J,co=Y;function lo({...o}){return e.jsx(to,{"data-slot":"popover",...o})}function io({...o}){return e.jsx(so,{"data-slot":"popover-trigger",...o})}function po({className:o,align:t="center",sideOffset:a=4,...n}){return e.jsx(no,{children:e.jsx(co,{"data-slot":"popover-content",align:t,sideOffset:a,className:ue("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-72 origin-(--radix-popover-content-transform-origin) rounded-md border p-4 shadow-md outline-hidden",o),...n})})}function mo({columns:o,data:t,isLoading:a,onSelect:n,label:r,value:s,onChange:c}){const[i,u]=fe.useState(!1),p=Fe({data:t,columns:o,columnResizeMode:"onChange",enableRowSelection:!0,enableColumnFilters:!0,getCoreRowModel:Ee(),getFilteredRowModel:Se(),getSortedRowModel:ye()}),h=f=>{c?.(f?.original),n?.(f.original),u(!1)};return e.jsxs(lo,{open:i,onOpenChange:u,children:[e.jsx(io,{asChild:!0,children:e.jsxs($,{variant:"outline",role:"combobox",className:"w-full justify-between",children:[s||r,e.jsx(He,{})]})}),e.jsx(po,{className:"w-[600px] p-2",children:e.jsx(Ve,{variant:"dropdown",table:p,isLoading:a,onSelectRow:h})})]})}b({accessorKey:O.departmentID.name,header:O.departmentID.label}),b({accessorKey:O.departmentID.name,header:O.departmentName.label}),b({accessorKey:O.headDepartmentName.name,header:O.headDepartmentName.label}),b({accessorKey:w.createdAtFormat.name,header:w.createdAtFormat.label}),b({accessorKey:w.createdByName.name,header:w.createdByName.label}),b({accessorKey:w.updatedAtFormat.name,header:w.updatedAtFormat.label}),b({accessorKey:w.updatedAtFormat.name,header:w.updatedAtFormat.label});const uo=[b({header:I.projectCode.label,accessorKey:I.projectCode.name}),b({header:I.projectName.label,accessorKey:I.projectName.name})],fo=()=>{const{request:o}=Ke();async function t(a,n){const r=new FormData;return r.append("param[offset]",a.offset),r.append("param[limit]",a.limit),r.append("param[sort]",a.sort),r.append("param[order]",a.order),a.filter!=="{}"&&r.append("param[filter]",a.filter),n.forEach(s=>{r.append("table[]",s)}),o({url:"/universal/dropdown-table",method:"POST",data:r})}return{dropdownTable:t}},ho=()=>{const{dropdownTable:o}=fo();async function t(a,n,r,s){return qe(async()=>{const c=await o(a,n),i={};for(const u of n){const p=c[u],h=r[u];i[u]={...p,rows:p.rows.map(f=>new h(f))}}return i},s)}return{dropdownTable:t}};function Bo({clientDatabaseDTO:o,open:t,onOpenChange:a}){const n=he(),{form:r,setFormError:s,clientDatabaseViewModel:c,setClientDatabaseViewModel:i}=$e({clientDatabaseDTO:o}),{createClientDatabase:u,updateClientDatabase:p}=Re(),{dropdownTable:h}=ho(),f={offset:"0",limit:"20",sort:"createdAtFormat",order:"desc",filter:"{}"},{data:x,refetch:E}=ze({queryKey:["/universal/dropdown-table",f],queryFn:async()=>await h(f,["project"],{project:Le}),enabled:!1});d.useEffect(()=>{E()},[E]);const K=Oe(),R=Me(m=>m.loading.global),ae=async()=>{const A={...r.getValues(),...c?.UUID?{UUID:c.UUID}:{}};A?.UUID?await p(A,{onSuccess:j=>{i(j),a(!1)},onError:j=>{s(j,{setToastError(U){K("Error",U,"error")}})}}):await u(A,{onSuccess:j=>{n(xe(j)),i(j),a(!1)},onError:j=>{s(j,{setToastError(U){K("Error",U,"error")}})}})};return e.jsx(be,{open:t,onOpenChange:a,children:e.jsx(je,{className:"sm:max-w-[720px]",showCloseButton:!1,children:e.jsx("div",{className:"w-full",children:e.jsx(Pe,{...r,children:e.jsxs("form",{className:"grid grid-cols-3 gap-4",onSubmit:r.handleSubmit(ae),children:[e.jsxs(ve,{className:"mb-4 col-span-3 flex flex-row items-center justify-start",children:[e.jsx(Ae,{}),e.jsx(ge,{asChild:!0,children:e.jsx($,{variant:"ghost",type:"button",className:"cursor-pointer rounded-full",children:e.jsx(Be,{className:"h-5 w-5 text-accent-foreground dark:text-accent-foreground"})})})]}),e.jsx(g,{control:r.control,name:l.databaseName.name,render:({field:m})=>e.jsxs(P,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.databaseName.label}),e.jsx(F,{children:e.jsx(S,{...m,disabled:R,required:!0})}),e.jsx(y,{})]})}),e.jsx(g,{control:r.control,name:l.databaseSchema.name,render:({field:m})=>e.jsxs(P,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.databaseSchema.label}),e.jsx(F,{children:e.jsx(S,{...m,disabled:R,required:!0})}),e.jsx(y,{})]})}),e.jsx(g,{control:r.control,name:l.host.name,render:({field:m})=>e.jsxs(P,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.host.label}),e.jsx(F,{children:e.jsx(S,{...m,disabled:R,required:!0})}),e.jsx(y,{})]})}),e.jsx(g,{control:r.control,name:l.port.name,render:({field:m})=>e.jsxs(P,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.port.label}),e.jsx(F,{children:e.jsx(S,{...m,disabled:R,required:!0})}),e.jsx(y,{})]})}),e.jsx(g,{control:r.control,name:l.username.name,render:({field:m})=>e.jsxs(P,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.username.label}),e.jsx(F,{children:e.jsx(S,{...m,disabled:R,required:!0})}),e.jsx(y,{})]})}),e.jsx(g,{control:r.control,name:l.password.name,render:({field:m})=>e.jsxs(P,{className:"my-1 ml-1 mb-1",children:[e.jsx(D,{children:l.password.label}),e.jsx(F,{children:e.jsx(S,{...m,disabled:R,required:!0})}),e.jsx(y,{})]})}),e.jsx(g,{name:l.project.name,render:({field:m})=>e.jsx(P,{className:"hidden",children:e.jsx(S,{...m})})}),e.jsx(g,{name:l.project.name,render:({field:m})=>e.jsxs(P,{children:[e.jsx(D,{children:l.projectName.label}),e.jsx(F,{children:e.jsx(mo,{...m,columns:uo,data:x?.project?.rows??[],isLoading:R,label:l.project.label,onSelect:A=>{m.onChange(A.projectName),r.setValue("project",A.UUID)}})}),e.jsx(y,{})]})})]})})})})})}export{Bo as default};
