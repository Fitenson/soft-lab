import{a as p,j as e,E as Z,P as Q,N as P,Z as W,L as B,M as I,af as Y,x as ee,h as te}from"./main-DGN5mpaW.js";import{u as ae,f as re,b as se}from"./index-D_B5YpTE.js";import{T as ne,a as oe,b as j,c as le,d as ie,e as z}from"./table-DGC0Bthf.js";import{c as S}from"./ColumnConfig-DR8mfO1N.js";import{A as k}from"./ApiTestDataFormField-BQWEFUsU.js";import{u as ce,S as de,a as ue,c as pe,d as N}from"./select-BRjx-kdU.js";import{C as he}from"./check-BT9zVP8v.js";import{S as fe}from"./skeleton-CCRZ9_1l.js";import{u as be}from"./useAppSelector-Dph1zFC5.js";import{I as me}from"./input-DPyRlekn.js";import{F as xe,a as E,b as F,d as D}from"./form-BgLuWa9O.js";import{d as ge}from"./index.esm-Blm62Et2.js";import ke from"./table-selection-popover-DGiDUS3y.js";import"./button-CtPdyM7S.js";import"./createLucideIcon-C6BJ9PvY.js";import"./index-Cn6xpbXL.js";import"./index-BPkJt45m.js";import"./label-DvgNmBcm.js";import"./popover-DicmKF-j.js";import"./index-DGcFUpkZ.js";import"./ClientDatabaseTableViewModel-CWID7VbN.js";import"./clientDatabaseSelectors-BCEKIPh0.js";import"./loader-circle-C5vmr0Xp.js";var T="Checkbox",[Ce,Qe]=Z(T),[ve,_]=Ce(T);function ye(t){const{__scopeCheckbox:n,checked:c,children:o,defaultChecked:l,disabled:r,form:m,name:h,onCheckedChange:i,required:C,value:v="on",internal_do_not_use_render:s}=t,[a,f]=W({prop:c,defaultProp:l??!1,onChange:i,caller:T}),[d,u]=p.useState(null),[x,b]=p.useState(null),g=p.useRef(!1),w=d?!!m||!!d.closest("form"):!0,R={checked:a,disabled:r,setChecked:f,control:d,setControl:u,name:h,form:m,value:v,hasConsumerStoppedPropagationRef:g,required:C,defaultChecked:y(l)?!1:l,isFormControl:w,bubbleInput:x,setBubbleInput:b};return e.jsx(ve,{scope:n,...R,children:je(s)?s(R):o})}var L="CheckboxTrigger",O=p.forwardRef(({__scopeCheckbox:t,onKeyDown:n,onClick:c,...o},l)=>{const{control:r,value:m,disabled:h,checked:i,required:C,setControl:v,setChecked:s,hasConsumerStoppedPropagationRef:a,isFormControl:f,bubbleInput:d}=_(L,t),u=B(l,v),x=p.useRef(i);return p.useEffect(()=>{const b=r?.form;if(b){const g=()=>s(x.current);return b.addEventListener("reset",g),()=>b.removeEventListener("reset",g)}},[r,s]),e.jsx(P.button,{type:"button",role:"checkbox","aria-checked":y(i)?"mixed":i,"aria-required":C,"data-state":V(i),"data-disabled":h?"":void 0,disabled:h,value:m,...o,ref:u,onKeyDown:I(n,b=>{b.key==="Enter"&&b.preventDefault()}),onClick:I(c,b=>{s(g=>y(g)?!0:!g),d&&f&&(a.current=b.isPropagationStopped(),a.current||b.stopPropagation())})})});O.displayName=L;var M=p.forwardRef((t,n)=>{const{__scopeCheckbox:c,name:o,checked:l,defaultChecked:r,required:m,disabled:h,value:i,onCheckedChange:C,form:v,...s}=t;return e.jsx(ye,{__scopeCheckbox:c,checked:l,defaultChecked:r,disabled:h,required:m,onCheckedChange:C,name:o,form:v,value:i,internal_do_not_use_render:({isFormControl:a})=>e.jsxs(e.Fragment,{children:[e.jsx(O,{...s,ref:n,__scopeCheckbox:c}),a&&e.jsx(J,{__scopeCheckbox:c})]})})});M.displayName=T;var H="CheckboxIndicator",K=p.forwardRef((t,n)=>{const{__scopeCheckbox:c,forceMount:o,...l}=t,r=_(H,c);return e.jsx(Q,{present:o||y(r.checked)||r.checked===!0,children:e.jsx(P.span,{"data-state":V(r.checked),"data-disabled":r.disabled?"":void 0,...l,ref:n,style:{pointerEvents:"none",...t.style}})})});K.displayName=H;var q="CheckboxBubbleInput",J=p.forwardRef(({__scopeCheckbox:t,...n},c)=>{const{control:o,hasConsumerStoppedPropagationRef:l,checked:r,defaultChecked:m,required:h,disabled:i,name:C,value:v,form:s,bubbleInput:a,setBubbleInput:f}=_(q,t),d=B(c,f),u=ce(r),x=Y(o);p.useEffect(()=>{const g=a;if(!g)return;const w=window.HTMLInputElement.prototype,A=Object.getOwnPropertyDescriptor(w,"checked").set,G=!l.current;if(u!==r&&A){const X=new Event("click",{bubbles:G});g.indeterminate=y(r),A.call(g,y(r)?!1:r),g.dispatchEvent(X)}},[a,u,r,l]);const b=p.useRef(y(r)?!1:r);return e.jsx(P.input,{type:"checkbox","aria-hidden":!0,defaultChecked:m??b.current,required:h,disabled:i,name:C,value:v,form:s,...n,tabIndex:-1,ref:d,style:{...n.style,...x,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});J.displayName=q;function je(t){return typeof t=="function"}function y(t){return t==="indeterminate"}function V(t){return y(t)?"indeterminate":t?"checked":"unchecked"}function U({className:t,...n}){return e.jsx(M,{"data-slot":"checkbox",className:ee("peer border-input dark:bg-input/30 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground dark:data-[state=checked]:bg-primary data-[state=checked]:border-primary focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive size-4 shrink-0 rounded-[4px] border shadow-xs transition-shadow outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",t),...n,children:e.jsx(K,{"data-slot":"checkbox-indicator",className:"flex items-center justify-center text-current transition-none",children:e.jsx(he,{className:"size-3.5"})})})}function Se(t,n){return({getValue:c,row:o})=>{const l=!!c(),r=o.original,m=n?.disabled?.(r)??!1,h=n?.ariaLabel?.(r)??"Toggle";return e.jsx("div",{className:"flex items-center",onClick:i=>i.stopPropagation(),children:e.jsx(U,{checked:l,disabled:m,"aria-label":h,onCheckedChange:i=>t({row:r,next:!!i}),className:"translate-y-[1px]"})})}}const Te=[S({accessorKey:k.enabled.name,header:null,size:44,minSize:36,maxSize:64,enableSorting:!1,cell:Se(({row:t,next:n})=>{console.log(t),console.log(n)},{})}),S({accessorKey:k.key.name,header:k.key.label,enableSorting:!1}),S({accessorKey:k.value.name,header:k.value.label,enableSorting:!1}),S({accessorKey:k.description.name,header:k.description.label,enableSorting:!1})];class ${field={};table=new Set;type=null;setField(n){switch(this.type=n,n){case"text":this.field={text:"string"};break;case"file":this.field={file:"base64"};break;case"dropdown":this.field={};break;default:throw new Error("Unknown field type "+n)}}setDropdown(n){if(this.type!=="dropdown")throw new Error("setDropdown() can only be used after setField('dropdown')");if(this.table.has(n))throw new Error(`Duplicate table name: ${n}`);this.table.add(n),this.field={dropdown:{table:n}}}asJSONString(){return JSON.stringify(this.field,null,2)}asJson(){return this.field}getField(){return this.field}}const we=["key","value","description"],Re=t=>we.includes(t);function We({form:t}){const[n,c]=p.useState(!1),{fields:o,append:l}=ge({control:t.control,name:"apiTestData"}),r=ae({data:t.getValues("apiTestData")??[],columns:Te,enableRowSelection:!0,enableSorting:!1,enableFilters:!1,enableSortingRemoval:!1,getCoreRowModel:se()}),m=be(te),h=p.useRef(null),i=s=>{if(typeof s=="number"){if(h.current===s)return;h.current=s}const a=new $;a.setField("text"),l({enabled:0,key:"",value:"",description:"",fieldType:a.asJSONString()},{shouldFocus:!1})},C=(s,a)=>{t.setValue(`apiTestData.${s}.enabled`,a),s===o.length-1&&a===1&&i(s)},v=s=>{t.getValues(`apiTestData.${s}.enabled`)!==1&&t.setValue(`apiTestData.${s}.enabled`,1),s===o.length-1&&i(s)};return p.useEffect(()=>{o.length===0&&(l({enabled:0,key:"",value:"",description:""},{shouldFocus:!1}),h.current=null)},[o.length,l]),e.jsx(xe,{...t,children:e.jsxs(ne,{className:"card",children:[e.jsx(oe,{children:r.getHeaderGroups().map(s=>e.jsx(j,{className:"border-b border-accent dark:border-accent",children:s.headers.map(a=>e.jsxs(le,{className:"m-0 p-0 border-r border-accent dark:border-accent last:border-r-0",style:{width:a.getSize()},children:[a.isPlaceholder?null:re(a.column.columnDef.header,a.getContext()),a.column.getCanResize()&&e.jsx("div",{onMouseDown:a.getResizeHandler(),onTouchStart:a.getResizeHandler(),className:`absolute right-0 top-0 h-full w-1 cursor-col-resize select-none
                                            ${a.column.getIsResizing()?"bg-blue-500":"bg-transparent hover:bg-gray-400"}`})]},a.id))},s.id))}),e.jsx(ie,{children:m?Array.from({length:5}).map((s,a)=>e.jsx(j,{children:r.getAllLeafColumns().map(f=>e.jsx("td",{className:"px-2 py-2",children:e.jsx(fe,{className:"h-4 w-full rounded-2xl p-4 m-1 gap-2"})},f.id))},`skeleton-${a}`)):o.length>0?o.map((s,a)=>e.jsx(j,{className:"cursor-pointer p-2 border border-accent dark:border-accent text-foreground dark:text-foreground",children:r.getAllLeafColumns().map(f=>e.jsx(z,{className:"p-2",children:f.id===k.enabled.name?e.jsx(E,{control:t.control,name:`apiTestData.${a}.enabled`,render:({field:d})=>e.jsx(F,{children:e.jsx(D,{children:e.jsx("div",{onClick:u=>u.stopPropagation(),className:"flex items-center",children:e.jsx(U,{checked:d.value===1,onCheckedChange:u=>{const x=u?1:0;d.onChange(x),C(a,x)},"aria-label":"Toggle",className:"cursor-pointer h-6 w-6 shrink-0 translate-y-[1px]"})})})})}):Re(f.id)&&e.jsxs("div",{className:"flex flex-row gap-1",children:[e.jsx(E,{control:t.control,name:`apiTestData.${a}.${f.id}`,render:({field:d})=>e.jsx(F,{children:e.jsx(D,{children:e.jsx(me,{...d,value:d.value??"",onChange:u=>d.onChange(u.target.value),onFocus:()=>v(a),className:"w-full h-8"})})})}),e.jsx(E,{name:`apiTestData.${a}.${k.fieldType.name}`,control:t.control,render:({field:d})=>e.jsx(F,{children:e.jsx(D,{children:f.id===k.value.name&&e.jsxs(p.Fragment,{children:[e.jsxs(de,{onValueChange:u=>{const x=new $;x.setField(u),u==="dropdown"&&(setTimeout(()=>c(!0),500),x.setDropdown("user")),d.onChange(x.asJSONString())},children:[e.jsx(ue,{className:"h-6 w-6 flex items-center justify-center rounded-md border text-xs p-1"}),e.jsxs(pe,{children:[e.jsx(N,{value:"text",children:"Text"}),e.jsx(N,{value:"dropdown",children:"Dropdown"}),e.jsx(N,{value:"file",children:"File"})]})]}),e.jsx(ke,{isOpen:n,setIsOpen:c})]})})})})]})},f.id))},s.id)):e.jsx(j,{children:e.jsx(z,{colSpan:r.getAllLeafColumns().length,className:"h-24 text-center text-muted-foreground",children:"No test data rows found."})})})]})})}export{We as default};
