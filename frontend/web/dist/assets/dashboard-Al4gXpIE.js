import{u as k,a as N,l as O,j as e,H as C,b as T,t as n,d,e as b,f as x,g as A}from"./main-wTblVsq0.js";import{A as I}from"./app-layout-D0uPDn8S.js";import q from"./api-test-layout-Bb0zxC94.js";import H from"./test-case-sidebar-DHG33dik.js";import L from"./test-case-form-CNtZS5u7.js";import P from"./test-case-output-JYMWkuih.js";import{u as j}from"./useQuery-0mnIjHyj.js";import{u as _}from"./useApiTestService-DsKdZBtx.js";import{F as K}from"./index.esm-CZz6cprQ.js";import{u as Q}from"./documentation-tab-BC9TUIiB.js";import{u as f}from"./useAppSelector-BW6dmEz4.js";import{s as R}from"./apiTestSelectors-BJyltacD.js";import{F as z}from"./form-CEUoIQsp.js";import{s as h}from"./clientDatabaseSelectors-BCEKIPh0.js";import{u as B}from"./use-show-toast-BSGP1Bhq.js";import{u as G}from"./useClientDatabaseService-dSO1RnZE.js";import"./button-BKtYD9UH.js";import"./index-L13OofM9.js";import"./index-B8kHX97E.js";import"./x-CiPR1T7H.js";import"./createLucideIcon-C5-kp_dk.js";import"./chevron-right-Cz1vY7eM.js";import"./dropdown-menu-DZ6sB29m.js";import"./index-DM4NgvGr.js";import"./index-BB0IBzWE.js";import"./index-5KueQA_e.js";import"./check-CTufcYB2.js";import"./useAuthState-BElMWhPe.js";import"./index-Dm0UqNOR.js";import"./tree-view-CqOK4aNA.js";import"./input-B7ehP6LW.js";import"./ApiTestFormField-Mbezg9jC.js";import"./ApiTestViewModel-DYXz1GS2.js";import"./skeleton-DSleaXBS.js";import"./tabs-ByzZ6h7y.js";import"./data-tab-VSXOC9aU.js";import"./select-BUeZboHz.js";import"./api-test-data-table-Bi5ikZG0.js";import"./index-C_TaKwYQ.js";import"./table-A-yJ4UV_.js";import"./ColumnConfig-BsQ6chWg.js";import"./ApiTestDataFormField-DE3smGIc.js";import"./table-selection-popover-B30BGSba.js";import"./popover-BDwlhlqd.js";import"./label-CAlckq6-.js";import"./ClientDatabaseTableViewModel-CWID7VbN.js";import"./loader-circle-BpAhSxMv.js";import"./scenario-tab-5HMk8v1c.js";import"./useRequest-BCnKN7Wn.js";import"./BaseEntity-DGhPHkWu.js";import"./serviceHandler-BlQljMi1.js";import"./ClientDatabaseViewModel-CZz8IN5P.js";import"./zod-UmGTRyvS.js";import"./schemas-D95ZC4Tg.js";import"./textarea-DccAv0VT.js";function Wt(){const r=k(),{indexApiTest:g,createApiTest:y,updateApiTest:v}=_(),a=f(R),o=f(h),D=f(h),{form:i}=Q({apiTestDTO:a}),c=B(),F={offset:"0",limit:"10",sort:"table",order:"asc",filter:""},{data:u}=j({queryKey:["/backend/api_test/index"],queryFn:async()=>await g(),enabled:!0});j({queryKey:["/backend/client_database/get-table-list"],queryFn:async()=>{await S({params:F,clientDatabaseToken:D?.password??""},{callbacks:{onSuccess:s=>{const p={total:s.total,rows:s.rows.map(m=>m.dto)};r(A(p))},onError:s=>{c("Error","Failed to load client database tables","error"),console.error(s)}}})},enabled:!!D?.password});const{getTableList:S}=G();N.useEffect(()=>{u&&r(O(u))},[r,u]);const U=async()=>{try{if(a&&o&&o.password){const p=i.getValues("apiTestData").map(t=>({apiTest:a.UUID,enabled:t.enabled??"0",key:t.key??"",value:t.value??"",description:t.description??"",fieldType:t.fieldType??""})),m={...i.getValues(),UUID:a.UUID,project:o.project,clientDatabase:o.UUID,apiTestHasDatas:p??[]},l=[a?.UUID].filter(t=>t!==void 0);a.isNew?await y({apiTestDTO:m,clientDatabaseToken:o.password},{onSuccess:t=>{r(d(l)),r(b(t)),r(n({action:null})),r(x(t.apiTestDTO))},onError:t=>{console.error(t),c("Error","Failed to create test case","error"),r(T()),r(n({action:null})),r(d(l))}}):await v({apiTestDTO:m,clientDatabaseToken:o.password},{onSuccess:t=>{r(d(l)),r(b(t)),r(n({action:null})),r(x(t.apiTestDTO)),console.log("ViewModel: ",t),i.reset({parentApiTest:t.parentApiTest??"",clientDatabase:t.clientDatabase??"",project:t.project??"",testName:t.testName??"",isFolder:t.isFolder??0,transmission:t.transmission??"",description:t.description??"",moreDescription:t.moreDescription??"",apiTestData:t.apiTestData?t?.apiTestData.map(E=>E.dto):[]})},onError:t=>{console.error(t),c("Error","Failed to create test case","error"),r(T()),r(n({action:null})),r(d(l))}})}else throw new Error("Missing Client Database Token")}catch(s){console.error(s);const p=s instanceof Error?s.message:typeof s=="string"?s:"Unexpected error occurred";c("Error",p,"error")}};return e.jsxs(I,{children:[e.jsx(C,{title:"API Test"}),e.jsx(q,{children:e.jsxs(K,{...i,children:[e.jsx("div",{className:"w-60 border-none flex-shrink-0 mx-2",children:e.jsx(H,{})}),e.jsx("div",{className:"flex-1 flex flex-coloverflow-auto w-full",children:e.jsx("div",{className:"flex flex-1 space-x-2",children:e.jsx(z,{...i,children:e.jsxs("form",{onSubmit:i.handleSubmit(U),className:"grid grid-cols-1 md:grid-cols-5 gap-2 w-full",children:[e.jsx("div",{className:"border rounded-lg p-4 md:col-span-3",children:e.jsx(L,{})}),e.jsx("div",{className:"border rounded-lg p-4 md:col-span-2",children:e.jsx(P,{})})]})})})})]})})]})}export{Wt as default};
