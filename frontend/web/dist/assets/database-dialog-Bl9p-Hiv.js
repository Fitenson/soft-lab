import{j as e,f as N,c as x,a as I,I as V}from"./main-BMKQZ1-9.js";import{R as M,C as k,a as F,P as O,O as R}from"./index-BOig5Dx5.js";import{X as T}from"./index-DScR2D59.js";import{F as P,a as p,b as D,c as f,d as w,e as j}from"./form-IOjb17N-.js";import{I as g}from"./input-1jZS9_RG.js";import{u as z,a as B}from"./zod-CS4dlPCd.js";import{C as U}from"./ClientDatabaseViewModel-DsBbqFSV.js";import{o as q,s as C}from"./schemas-6m5s2bNq.js";import{B as H}from"./button-L5Bdowtk.js";import{S as G}from"./save-button-DTk_2MZq.js";import{h as v}from"./serviceHandler-BlQljMi1.js";import{u as K}from"./useRequest-f1J6Viwt.js";import{B as L}from"./BaseEntity-DGhPHkWu.js";import{u as X}from"./use-show-toast-hD1_VNWX.js";import"./createLucideIcon--EB0Hyv6.js";import"./useAppSelector-Czgba2EM.js";function $({...s}){return e.jsx(M,{"data-slot":"dialog",...s})}function A({...s}){return e.jsx(O,{"data-slot":"dialog-portal",...s})}function J({...s}){return e.jsx(F,{"data-slot":"dialog-close",...s})}function Q({className:s,...a}){return e.jsx(R,{"data-slot":"dialog-overlay",className:N("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...a})}function W({className:s,children:a,showCloseButton:u=!0,...n}){return e.jsxs(A,{"data-slot":"dialog-portal",children:[e.jsx(Q,{}),e.jsxs(k,{"data-slot":"dialog-content",className:N("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...n,children:[a,u&&e.jsxs(F,{"data-slot":"dialog-close",className:"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",children:[e.jsx(T,{}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]})}function Y({className:s,...a}){return e.jsx("div",{"data-slot":"dialog-header",className:N("flex flex-col gap-2 text-center sm:text-left",s),...a})}const r={databaseName:x({name:"databaseName",label:"Database Name",max:50}),databaseSchema:x({name:"databaseSchema",label:"Database Schema",max:50}),host:x({name:"host",label:"Host",max:50}),port:x({name:"port",label:"Port",max:50}),username:x({name:"username",label:"Username",max:50}),password:x({name:"password",label:"Password",max:50})},Z=q({databaseName:C().max(r.databaseName.max,{error:r.databaseName.maxError}),databaseSchema:C().max(r.databaseSchema.max,{error:r.databaseSchema.maxError}),host:C().max(r.host.max,{error:r.host.maxError}),port:C().max(r.port.max,{error:r.port.maxError}),username:C().max(r.username.max,{error:r.username.maxError}),password:C().max(r.password.max,{error:r.password.maxError})}),ee=({clientDatabaseDTO:s})=>{const[a,u]=I.useState(()=>s?new U(s):void 0),n=z({resolver:B(Z),defaultValues:{databaseName:a?.databaseName??"",databaseSchema:a?.databaseSchema??"",host:a?.host??"",port:a?.port??"",username:a?.username??"",password:a?.password??""}});return{form:n,setFormError:(m,c)=>{const{setToastError:d}=c||{},l=m,t=l?.response?.data?.errors??{};typeof t=="string"?d?.(t):t&&Object.keys(t).length>0?Object.keys(t).forEach(i=>{const o=i.replace(/^clientDatabase\./,"");o in n.getValues()&&n.setError(o,{type:"server",message:t[i][0]??"Invalid value"})}):d?.(l?.response?.data?.message??"Server error")},clientDatabaseViewModel:a,setClientDatabaseViewModel:u}},ae=["UUID","host","port","databaseName","databaseSchema","username","password","refreshToken","valid"];function E(s,a){return V(s,ae,a,"clientDatabase")}class S extends L{_UUID;_databaseName;_databaseSchema;_refreshToken;_host;_port;_username;_password;_valid;constructor(a){super(a),this._UUID=a.UUID??"",this._databaseName=a.databaseName??"",this._databaseSchema=a.databaseSchema??"",this._refreshToken=a.refreshToken??"",this._host=a.host??"",this._port=a.port??"",this._username=a.username??"",this._password=a.password??"",this._valid=a.valid??!0}asViewModel(){return new U(this.asDto())}get UUID(){return this._UUID}set UUID(a){this._UUID=a}get databaseName(){return this._databaseName}set databaseName(a){this._databaseName=a}get databaseSchema(){return this._databaseSchema}set databaseSchema(a){this._databaseSchema=a}get refreshToken(){return this._refreshToken}set refreshToken(a){this._refreshToken=a}get host(){return this._host}set host(a){this._host=a}get port(){return this._port}set port(a){this._port=a}get username(){return this._username}set username(a){this._username=a}get password(){return this._password}set password(a){this._password=a}get valid(){return this._valid}set valid(a){this._valid=a}}const se=()=>{const{request:s}=K();return{indexClientDatabase:async()=>await s({url:"client-database/index",method:"GET"}),createClientDatabase:async m=>{const c=m.asDto(),d=E(c,new FormData),t=(await s({url:"/client-database/create",method:"POST",data:d})).clientDatabase;return new S(t)},updateClientDatabase:async m=>{const c=m.asDto(),d=E(c,new FormData),t=(await s({url:`/client-database/update?id=${c.UUID}`,method:"POST",data:d})).clientDatabase;return new S(t)},removeClientDatabase:async m=>{const c=new FormData;return m.forEach(d=>{c.append("UUIDs[]",d)}),await s({url:"/user/remove",method:"POST",data:c})}}},te=()=>{const{indexClientDatabase:s,createClientDatabase:a,updateClientDatabase:u,removeClientDatabase:n}=se();return{indexClientDatabase:async l=>v(async()=>{const t=await s(),i=t.rows.map(o=>new U(o));return{...t,rows:i}},l),createClientDatabase:async(l,t)=>{let i=new S(l);return i=await v(async()=>a(i),{...t,onSuccess:o=>{const h=o.asViewModel();t?.onSuccess?.(h)}}),i.asViewModel()},updateClientDatabase:async(l,t)=>{let i=new S(l);return i=await v(async()=>u(i),{...t,onSuccess:o=>{const h=o.asViewModel();t?.onSuccess?.(h)}}),i.asViewModel()},removeClientDatabase:async(l,t)=>await v(async()=>n(l),t)}};function je({clientDatabaseDTO:s,open:a,onOpenChange:u}){const{form:n,setFormError:y,clientDatabaseViewModel:m,setClientDatabaseViewModel:c}=ee({clientDatabaseDTO:s}),{createClientDatabase:d,updateClientDatabase:l}=te(),t=X(),i=async()=>{const h={...n.getValues(),...m?.UUID?{UUID:m.UUID}:{}};h?.UUID?await l(h,{onSuccess:b=>{c(b),u(!1)},onError:b=>{y(b,{setToastError(_){t("Error",_,"error")}})}}):await d(h,{onSuccess:b=>{c(b),u(!1)},onError:b=>{console.log("Error",b),y(b,{setToastError(_){console.log("Message",_),t("Error",_,"error")}})}})};return e.jsx($,{open:a,onOpenChange:u,children:e.jsx(W,{className:"sm:max-w-[520px]",showCloseButton:!1,children:e.jsx("div",{className:"w-full",children:e.jsx(P,{...n,children:e.jsxs("form",{className:"grid grid-cols-2 gap-4",onSubmit:n.handleSubmit(i),children:[e.jsxs(Y,{className:"mb-4 col-span-2 flex flex-row items-center justify-start",children:[e.jsx(G,{}),e.jsx(J,{asChild:!0,children:e.jsx(H,{variant:"ghost",type:"button",className:"cursor-pointer rounded-full",children:e.jsx(T,{className:"h-5 w-5 text-accent-foreground dark:text-accent-foreground"})})})]}),e.jsx(p,{control:n.control,name:r.databaseName.name,render:({field:o})=>e.jsxs(D,{className:"my-1 ml-1 mb-1",children:[e.jsx(f,{children:r.databaseName.label}),e.jsx(w,{children:e.jsx(g,{...o})}),e.jsx(j,{})]})}),e.jsx(p,{control:n.control,name:r.databaseSchema.name,render:({field:o})=>e.jsxs(D,{className:"my-1 ml-1 mb-1",children:[e.jsx(f,{children:r.databaseSchema.label}),e.jsx(w,{children:e.jsx(g,{...o})}),e.jsx(j,{})]})}),e.jsx(p,{control:n.control,name:r.host.name,render:({field:o})=>e.jsxs(D,{className:"my-1 ml-1 mb-1",children:[e.jsx(f,{children:r.host.label}),e.jsx(w,{children:e.jsx(g,{...o})}),e.jsx(j,{})]})}),e.jsx(p,{control:n.control,name:r.port.name,render:({field:o})=>e.jsxs(D,{className:"my-1 ml-1 mb-1",children:[e.jsx(f,{children:r.port.label}),e.jsx(w,{children:e.jsx(g,{...o})}),e.jsx(j,{})]})}),e.jsx(p,{control:n.control,name:r.username.name,render:({field:o})=>e.jsxs(D,{className:"my-1 ml-1 mb-1",children:[e.jsx(f,{children:r.username.label}),e.jsx(w,{children:e.jsx(g,{...o})}),e.jsx(j,{})]})}),e.jsx(p,{control:n.control,name:r.password.name,render:({field:o})=>e.jsxs(D,{className:"my-1 ml-1 mb-1",children:[e.jsx(f,{children:r.password.label}),e.jsx(w,{children:e.jsx(g,{...o})}),e.jsx(j,{})]})})]})})})})})}export{je as default};
